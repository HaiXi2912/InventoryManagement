import{d as V,r as w,o as M,p as D,q as O,a as m,c as j,b as C,e as s,w as l,f as y,h as i,k as d,j as b,n as v,i as q,v as h,E as r,_ as I}from"./index-B2xfaXjR.js";const R={class:"orders"},T={class:"toolbar"},z=V({__name:"Orders",setup(A){const $=q(),f=w(!1),k=w([]);async function u(){f.value=!0;try{const{data:e}=await i.get("/api/orders");e?.success&&(k.value=e.data||[])}finally{f.value=!1}}function x(e){$.push(`/orders/${e.id}`)}async function N(e){await h.confirm("确定取消该订单？","提示");const{data:t}=await i.post(`/api/orders/${e.id}/cancel`);t?.success&&(r.success("已取消"),u())}async function B(e){try{const t=await i.get("/api/wallet/me").then(_=>_.data?.data),n=Number(t?.balance||0),o=Number(e.pay_amount||e.total_amount||0),p=(await i.get("/api/auth/me").then(_=>_.data?.data))?.id,a=p&&n>=o?{customer_id:p}:void 0,{data:c}=await i.post(`/api/orders/${e.id}/pay`,a);c?.success&&(r.success("支付成功"),u())}catch(t){r.error(t?.message||"支付失败")}}async function E(e){try{await h.confirm("确认已收到货物？","确认收货",{type:"warning"});const{data:t}=await i.post(`/api/orders/${e.id}/confirm`);t?.success&&(r.success("已确认收货"),u())}catch(t){t?.message&&t?.message!=="cancel"&&r.error(t?.message)}}return M(u),(e,t)=>{const n=y("el-button"),o=y("el-table-column"),g=y("el-table"),p=O("loading");return D((m(),j("div",R,[t[6]||(t[6]=C("h2",null,"我的订单",-1)),C("div",T,[s(n,{type:"primary",onClick:t[0]||(t[0]=a=>e.$router.push("/wallet"))},{default:l(()=>[...t[1]||(t[1]=[d("我的钱包",-1)])]),_:1})]),s(g,{data:k.value,border:""},{default:l(()=>[s(o,{prop:"order_no",label:"订单号",width:"180"}),s(o,{prop:"status",label:"状态",width:"120"}),s(o,{prop:"pay_status",label:"支付",width:"120"}),s(o,{prop:"total_amount",label:"金额",width:"120"}),s(o,{prop:"logistics_provider",label:"承运商",width:"120"}),s(o,{prop:"tracking_no",label:"物流单号",width:"180"}),s(o,{label:"操作",width:"280"},{default:l(({row:a})=>[s(n,{type:"text",onClick:c=>x(a)},{default:l(()=>[...t[2]||(t[2]=[d("详情",-1)])]),_:1},8,["onClick"]),a.status==="pending"?(m(),b(n,{key:0,type:"text",onClick:c=>B(a)},{default:l(()=>[...t[3]||(t[3]=[d("去支付",-1)])]),_:1},8,["onClick"])):v("",!0),a.status==="shipped"?(m(),b(n,{key:1,type:"text",onClick:c=>E(a)},{default:l(()=>[...t[4]||(t[4]=[d("确认收货",-1)])]),_:1},8,["onClick"])):v("",!0),a.status!=="shipped"&&a.status!=="completed"&&a.status!=="cancelled"?(m(),b(n,{key:2,type:"text",onClick:c=>N(a)},{default:l(()=>[...t[5]||(t[5]=[d("取消",-1)])]),_:1},8,["onClick"])):v("",!0)]),_:1})]),_:1},8,["data"])])),[[p,f.value]])}}}),G=I(z,[["__scopeId","data-v-4b999e71"]]);export{G as default};
