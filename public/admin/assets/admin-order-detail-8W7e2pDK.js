
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as P,r as _,A as T,J as G,O as L,c as Q,e as l,I as b,H as k,f as a,w as s,j as W,E as c,q as X,i as r,p as Y,o as g,h as v,t as n,U as Z,v as ee,x as E}from"./index-CdiJTMf6.js";import{O as h}from"./orders-BJRiLtUw.js";const te={class:"order-detail"},le={class:"toolbar"},ae={class:"card-header"},se={class:"title"},oe={class:"sub"},ie={style:{"margin-left":"12px"}},ne={class:"grid2"},de={class:"field"},re={class:"field"},ue={class:"field"},pe={class:"field"},ce={class:"field"},ve={class:"field"},_e={class:"field"},R=P({__name:"admin-order-detail",setup(me){const V=Y(),N=X(),u=_(0),y=_(!1),t=_(null),m=_(!1),S=_(),d=_({tracking_no:"",logistics_provider:""});function F(){const o=Number(V.query.id);if(!Number.isNaN(o)&&o>0){u.value=o;return}const e=Number(V.params.id);if(!Number.isNaN(e)&&e>0){u.value=e;return}u.value=0}async function w(){if(F(),!u.value){c.warning("缺少订单ID"),N.replace({name:"adminOrders"});return}y.value=!0;try{const{data:o}=await h.detail(u.value);t.value=o}finally{y.value=!1}}function M(){if(t.value){if(t.value.status!=="paid")return c.warning("仅已支付订单可发货");d.value={tracking_no:"",logistics_provider:""},m.value=!0}}async function A(){if(u.value){if(!d.value.tracking_no)return c.warning("请填写物流单号");try{await h.ship(u.value,{tracking_no:d.value.tracking_no,logistics_provider:d.value.logistics_provider}),c.success("已发货"),m.value=!1,w()}catch(o){c.error((o==null?void 0:o.message)||"发货失败")}}}async function $(){if(t.value){if(t.value.status!=="shipped")return c.warning("仅已发货订单可完成");await Z.confirm("确认标记为已签收完成？","完成签收",{type:"warning"}),await h.complete(u.value),c.success("已完成"),w()}}return T(w),(o,e)=>{var q,B;const f=r("el-button"),j=r("el-tag"),x=r("el-card"),p=r("el-table-column"),z=r("el-table"),C=r("el-input"),D=r("el-form-item"),H=r("el-form"),J=r("el-dialog"),K=L("loading");return G((g(),Q("div",te,[l("div",le,[a(f,{onClick:e[0]||(e[0]=i=>W(N).back())},{default:s(()=>[...e[5]||(e[5]=[v("返回",-1)])]),_:1}),((q=t.value)==null?void 0:q.status)==="paid"?(g(),b(f,{key:0,type:"primary",onClick:M},{default:s(()=>[...e[6]||(e[6]=[v("发货",-1)])]),_:1})):k("",!0),((B=t.value)==null?void 0:B.status)==="shipped"?(g(),b(f,{key:1,type:"success",onClick:$},{default:s(()=>[...e[7]||(e[7]=[v("完成签收",-1)])]),_:1})):k("",!0)]),t.value?(g(),b(x,{key:0,class:"mb12"},{header:s(()=>[l("div",ae,[l("div",null,[l("div",se,"订单号："+n(t.value.order_no),1),l("div",oe,[e[8]||(e[8]=v(" 状态： ",-1)),a(j,{type:t.value.status==="paid"?"success":t.value.status==="shipped"?"warning":t.value.status==="completed"?"info":t.value.status==="cancelled"?"danger":"default"},{default:s(()=>[v(n(t.value.status),1)]),_:1},8,["type"]),l("span",ie,"应付金额：￥"+n(t.value.pay_amount),1)])])])]),default:s(()=>{var i,I,O,U;return[l("div",ne,[l("div",null,[e[9]||(e[9]=l("div",{class:"section-title"},"收货信息",-1)),l("div",de,"姓名："+n(((i=t.value.address)==null?void 0:i.name)||"-"),1),l("div",re,"电话："+n(((I=t.value.address)==null?void 0:I.phone)||"-"),1),l("div",ue,"地址："+n(((O=t.value.address)==null?void 0:O.full)||((U=t.value.address)==null?void 0:U.detail)||"-"),1)]),l("div",null,[e[10]||(e[10]=l("div",{class:"section-title"},"物流信息",-1)),l("div",pe,"承运商："+n(t.value.logistics_provider||"-"),1),l("div",ce,"物流单号："+n(t.value.tracking_no||"-"),1),l("div",ve,"发货时间："+n(t.value.shipped_at||"-"),1),l("div",_e,"签收时间："+n(t.value.delivered_at||"-"),1)])])]}),_:1})):k("",!0),t.value?(g(),b(x,{key:1},{header:s(()=>[...e[11]||(e[11]=[l("div",{class:"title"},"商品明细",-1)])]),default:s(()=>[a(z,{data:t.value.items||[],border:""},{default:s(()=>[a(p,{prop:"name",label:"商品","min-width":"200"}),a(p,{prop:"sku_id",label:"SKU",width:"100"}),a(p,{prop:"size",label:"尺码",width:"90"}),a(p,{prop:"color",label:"颜色",width:"90"}),a(p,{prop:"price",label:"单价",width:"100"}),a(p,{prop:"quantity",label:"数量",width:"100"}),a(p,{prop:"amount",label:"金额",width:"120"})]),_:1},8,["data"])]),_:1})):k("",!0),a(J,{modelValue:m.value,"onUpdate:modelValue":e[4]||(e[4]=i=>m.value=i),title:"订单发货",width:"460px"},{footer:s(()=>[a(f,{onClick:e[3]||(e[3]=i=>m.value=!1)},{default:s(()=>[...e[12]||(e[12]=[v("取消",-1)])]),_:1}),a(f,{type:"primary",onClick:A},{default:s(()=>[...e[13]||(e[13]=[v("确定发货",-1)])]),_:1})]),default:s(()=>[a(H,{model:d.value,ref_key:"shipFormRef",ref:S,"label-width":"100px"},{default:s(()=>[a(D,{label:"物流单号",required:""},{default:s(()=>[a(C,{modelValue:d.value.tracking_no,"onUpdate:modelValue":e[1]||(e[1]=i=>d.value.tracking_no=i),placeholder:"填写物流单号"},null,8,["modelValue"])]),_:1}),a(D,{label:"承运商"},{default:s(()=>[a(C,{modelValue:d.value.logistics_provider,"onUpdate:modelValue":e[2]||(e[2]=i=>d.value.logistics_provider=i),placeholder:"如：顺丰/中通/圆通"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])),[[K,y.value]])}}});typeof E=="function"&&E(R);const be=ee(R,[["__scopeId","data-v-5805cb22"]]);export{be as default};
