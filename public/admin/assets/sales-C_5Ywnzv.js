
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{P as D,d as el,r as b,F as xe,A as ll,c as I,e as f,f as l,w as a,E as y,i as w,o as h,h as v,J as tl,O as al,I as ee,t as U,R as se,S as de,H as K,Q as ol,g as ul,U as Ce,n as nl,v as il,x as Ne}from"./index-CdiJTMf6.js";import{P as re,a as Ie}from"./productExt-B7DASDm9.js";const B={getSaleList:V=>D.get("/sales",{params:V}),getSaleDetail:V=>D.get("/sales/".concat(V)),createSale:V=>D.post("/sales",V),updateSale:(V,P)=>D.put("/sales/".concat(V),P),removeSale:V=>D.delete("/sales/".concat(V)),confirmSale:V=>D.post("/sales/".concat(V,"/confirm"),{}),shipSale:(V,P)=>D.post("/sales/".concat(V,"/ship"),P||{}),completeSale:V=>D.post("/sales/".concat(V,"/complete"),{}),cancelSale:(V,P)=>D.post("/sales/".concat(V,"/cancel"),P||{})},sl={class:"sales-management"},dl={class:"search-section"},rl={class:"toolbar-section"},pl={class:"toolbar"},ml={class:"toolbar-left"},cl={class:"toolbar-right"},vl={class:"table-section"},fl={class:"amount"},gl={class:"pagination-section"},yl={style:{width:"100%"}},bl={class:"product-actions"},_l={class:"total-amount"},kl={class:"dialog-footer"},Sl={key:0},wl={key:1},Vl={key:0,style:{"margin-bottom":"10px","font-weight":"600",display:"flex","align-items":"center","justify-content":"space-between"}},hl={class:"sku-grid"},xl=["onClick"],Cl={class:"size"},Nl={class:"meta"},Il={class:"price"},Ul={key:0,style:{"margin-top":"6px"}},zl={key:1,style:{"margin-top":"12px",padding:"12px",background:"#fdf6ec",border:"1px dashed #f3d19e","border-radius":"4px"}},$l={key:2,style:{"margin-top":"12px",padding:"12px",background:"#f5f7fa","border-radius":"4px"}},ql={key:3,style:{"margin-top":"12px",padding:"12px",background:"#f5f7fa","border-radius":"4px",display:"flex","justify-content":"flex-end"}},Pl={style:{margin:"8px 0","text-align":"right"}},Dl={key:0,style:{"margin-left":"12px",display:"flex",gap:"12px","flex-wrap":"wrap","align-items":"center"}},Ue=el({__name:"sales",setup(V){const P=b(!1),S=b({keyword:"",status:"",paymentStatus:"",startDate:"",endDate:"",saleType:""}),pe=b([]),me=b(0),le=b(10),G=b(1),H=b(!1),ce=b("添加销售单"),te=b(""),r=b({orderNo:"",customerName:"",customerPhone:"",customerAddress:"",status:"pending",paymentStatus:"unpaid",items:[],remark:"",saleType:"wholesale"}),ae=b(!1),J=b([]),g=b(null),C=b(1),z=b([]),T=b({}),R=b(null),W=xe(()=>z.value.find(o=>String(o.id)===String(R.value))),$=b(null),E=b(""),A=b(!1),L=b({}),Q=b(!1),X=b([]),c=b({name:"",category:"",wholesale_price:0,retail_price:0,genSkus:!0,skuTemplate:"apparel",baseBarcode:"",initStock:0}),ze=async()=>{var o;try{const e=await re.getClothingMeta(),d=((o=e==null?void 0:e.data)==null?void 0:o.categories)||[];X.value=d}catch(e){X.value=[]}},ve=()=>{c.value={name:"",category:X.value[0]||"",wholesale_price:0,retail_price:0,genSkus:!0,skuTemplate:"apparel",baseBarcode:"",initStock:0}},$e=async()=>{var o,e;if(!c.value.name.trim()){y.warning("请输入商品名称");return}if(c.value.wholesale_price&&c.value.retail_price&&Number(c.value.wholesale_price)>Number(c.value.retail_price)){y.warning("批发价不可高于零售价");return}try{const d={name:c.value.name.trim(),category:c.value.category||null,wholesale_price:Number(c.value.wholesale_price||0),retail_price:Number(c.value.retail_price||0),status:"active"},u=await re.createProduct(d),n=((o=u==null?void 0:u.data)==null?void 0:o.product)||(u==null?void 0:u.data)||u,i=String((n==null?void 0:n.id)||((e=n==null?void 0:n.data)==null?void 0:e.id)||"");if(!i){y.error("创建商品失败");return}if(c.value.genSkus)try{await Ie.batchCreateSkusBySize(i,{template:c.value.skuTemplate,baseBarcode:c.value.baseBarcode||void 0,retail_price:Number(c.value.retail_price||0),stock:Number(c.value.initStock||0)})}catch(s){console.warn("批量创建SKU失败",s)}await _e(),await ne(i),g.value=J.value.find(s=>String(s.id)===i)||null,Q.value=!1,y.success("商品已创建")}catch(d){y.error("创建商品失败")}},fe=()=>{var u,n;if(!g.value){y.warning("请先选择商品");return}const o=Number(C.value||0);if(o<=0){y.warning("数量需大于0");return}const e=Number(((u=$.value)!=null?u:F(g.value))||0),d=(n=r.value.items)==null?void 0:n.find(i=>i.productId===g.value.id&&!i.skuId);if(d)d.quantity+=o,d.subtotal=d.quantity*d.price;else{const i={id:"".concat(Date.now(),"-nosku"),productId:g.value.id,productName:g.value.name,quantity:o,price:e,subtotal:o*e};r.value.items||(r.value.items=[]),r.value.items.push(i)}},oe=b(),qe={customerName:[{required:!0,message:"请输入客户姓名",trigger:"blur"}],customerPhone:[{required:!0,message:"请输入客户电话",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号码",trigger:"blur"}],customerAddress:[{required:!0,message:"请输入客户地址",trigger:"blur"}]},ge=xe(()=>{var o;return((o=r.value.items)==null?void 0:o.reduce((e,d)=>e+d.subtotal,0))||0}),ue={pending:{text:"待确认",type:"warning"},confirmed:{text:"已确认",type:"primary"},shipped:{text:"已发货",type:"info"},completed:{text:"已完成",type:"success"},cancelled:{text:"已取消",type:"danger"}},ye={unpaid:{text:"未付款",type:"warning"},paid:{text:"已付款",type:"success"},refunded:{text:"已退款",type:"info"}};function be(o){if(o)try{const e=typeof o=="string"?new Date(o):o,d=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return"".concat(d,"-").concat(u,"-").concat(n)}catch(e){return}}function F(o){var e,d,u;return o?r.value.saleType==="wholesale"?Number((d=(e=o.wholesale_price)!=null?e:o.price)!=null?d:0):Number((u=o.price)!=null?u:0):0}const M=async()=>{var o,e;P.value=!0;try{const d={page:G.value,size:le.value,status:S.value.status||void 0,payment_status:S.value.paymentStatus||void 0,sale_no:S.value.keyword||void 0,start_date:be(S.value.startDate),end_date:be(S.value.endDate),sale_type:S.value.saleType||void 0},u=await B.getSaleList(d),n=((o=u==null?void 0:u.data)==null?void 0:o.sales)||[];pe.value=n.map(s=>{var p,_,x;return{id:String(s.id),orderNo:s.sale_no,customerName:((p=s.customer)==null?void 0:p.name)||"",customerPhone:((_=s.customer)==null?void 0:_.phone)||"",customerAddress:((x=s.customer)==null?void 0:x.address)||"",totalAmount:Number(s.total_amount||0),status:s.status,paymentStatus:s.payment_status,createTime:s.createdAt?new Date(s.createdAt).toLocaleString():"",updateTime:s.updatedAt?new Date(s.updatedAt).toLocaleString():"",items:[],remark:s.remark||""}});const i=((e=u==null?void 0:u.data)==null?void 0:e.pagination)||{};me.value=i.total||i.total_count||0}catch(d){y.error("加载销售单失败")}finally{P.value=!1}},_e=async()=>{var o;try{const e=await re.getProductList({page:1,limit:100}),d=((o=e==null?void 0:e.data)==null?void 0:o.products)||[];J.value=d.map(u=>{var n,i,s,p,_,x,k;return{id:String(u.id),name:u.name,category:u.category||"-",price:Number(u.retail_price||0),wholesale_price:Number((i=(n=u.wholesale_price)!=null?n:u.retail_price)!=null?i:0),stock:Number((k=(x=(p=u.sku_stock_sum)!=null?p:(s=u.inventory)==null?void 0:s.available_stock)!=null?x:(_=u.inventory)==null?void 0:_.current_stock)!=null?k:0)}})}catch(e){y.error("加载商品列表失败")}},ne=async o=>{try{if(T.value[o]){z.value=T.value[o];return}const e=await Ie.listSkus(o),u=((e==null?void 0:e.data)||[]).map(n=>{var i,s;return{id:String(n.id),product_id:n.product_id,size:n.size,color:n.color,barcode:n.barcode,retail_price:Number((i=n.retail_price)!=null?i:0),stock:Number((s=n.stock)!=null?s:0),status:n.status}});z.value=u,T.value[o]=u}catch(e){y.error("加载SKU失败")}},ke=()=>{G.value=1,M()},Pe=()=>{S.value={keyword:"",status:"",paymentStatus:"",startDate:"",endDate:"",saleType:""},ke()},De=()=>{ce.value="添加销售单",te.value="",r.value={orderNo:Be(),customerName:"",customerPhone:"",customerAddress:"",status:"pending",paymentStatus:"unpaid",items:[],remark:"",saleType:"wholesale"},H.value=!0},Te=o=>{y.info("暂不支持编辑已存在销售单")},Ae=async o=>{try{await Ce.confirm("确定要取消这个销售单吗？","确认取消",{type:"warning"}),await B.cancelSale(o),y.success("已取消"),M()}catch(e){}},Fe=async(o,e)=>{try{await Ce.confirm('确定要将状态更改为"'.concat(ue[e].text,'"吗？'),"确认操作",{type:"warning"}),e==="confirmed"?await B.confirmSale(o):e==="shipped"?await B.shipSale(o):e==="completed"?await B.completeSale(o):e==="cancelled"&&await B.cancelSale(o),y.success("状态更新成功"),M()}catch(d){}},Be=()=>{const o=new Date,e=o.toISOString().slice(0,10).replace(/-/g,""),d=o.getTime().toString().slice(-6);return"SO".concat(e).concat(d)},Ee=()=>{_e(),ze(),g.value=null,z.value=[],C.value=1,R.value=null,$.value=null,E.value="",A.value=!1,L.value={},Q.value=!1,ve(),ae.value=!0},Me=async o=>{g.value=o,C.value=1,R.value=null,$.value=null,E.value="",A.value=!1,L.value={},await ne(o.id),(z.value||[]).length===0&&($.value=F(g.value))},Se=o=>{o&&(R.value=String(o.id),$.value=F(g.value))},Oe=()=>{if(!E.value)return;const o=z.value.find(e=>e.barcode&&e.barcode===E.value);if(!o){y.warning("条码未匹配到当前商品的SKU");return}Se(o)},Ke=()=>{var d,u,n,i;if(!g.value){y.warning("请先选择商品");return}const o=W.value;if(!o){(z.value||[]).length===0?fe():y.warning("请选择尺码");return}if(C.value<=0){y.warning("数量需大于0");return}if(((d=o.stock)!=null?d:0)<C.value){y.warning("库存不足（可用 ".concat((u=o.stock)!=null?u:0,"）"));return}const e=(n=r.value.items)==null?void 0:n.find(s=>s.productId===g.value.id&&s.skuId===String(o.id));if(e)e.quantity+=C.value,e.subtotal=e.quantity*e.price;else{const s=Number(((i=$.value)!=null?i:F(g.value))||0),p={id:Date.now().toString(),productId:g.value.id,productName:g.value.name,skuId:String(o.id),size:o.size,barcode:o.barcode,quantity:C.value,price:s,subtotal:C.value*s};r.value.items||(r.value.items=[]),r.value.items.push(p)}T.value[g.value.id]||(T.value[g.value.id]=z.value),R.value=null,$.value=null,C.value=1,E.value=""},Re=()=>{var d,u,n;if(!g.value){y.warning("请先选择商品");return}const o=Object.entries(L.value||{}).map(([i,s])=>({skuId:i,qty:Number(s||0)})).filter(i=>i.qty>0);if(!o.length){y.warning("请为至少一个尺码填写数量");return}const e=F(g.value);for(const i of o){const s=z.value.find(_=>String(_.id)===String(i.skuId));if(!s)continue;if(((d=s.stock)!=null?d:0)<i.qty){y.warning("尺码 ".concat(s.size," 库存不足（可用 ").concat((u=s.stock)!=null?u:0,"）"));continue}const p=(n=r.value.items)==null?void 0:n.find(_=>_.productId===g.value.id&&_.skuId===String(i.skuId));if(p)p.quantity+=i.qty,p.subtotal=p.quantity*p.price;else{const _=Number(e||0),x={id:"".concat(Date.now(),"-").concat(i.skuId),productId:g.value.id,productName:g.value.name,skuId:String(i.skuId),size:s.size,barcode:s.barcode,quantity:i.qty,price:_,subtotal:i.qty*_};r.value.items||(r.value.items=[]),r.value.items.push(x)}}L.value={}},Le=o=>{var e;(e=r.value.items)==null||e.splice(o,1)},Qe=o=>{o.quantity<0&&(o.quantity=0),o.subtotal=o.quantity*o.price},je=o=>{o.price<0&&(o.price=0),o.subtotal=o.quantity*o.price},He=async(o,e)=>{T.value[o.productId]||await ne(o.productId);const n=(T.value[o.productId]||z.value).find(i=>String(i.id)===String(e));if(n){if(o.skuId=String(n.id),o.size=n.size,o.barcode=n.barcode,!o.price||o.price===0){const i=J.value.find(s=>String(s.id)===String(o.productId));o.price=Number(F(i))}o.subtotal=o.quantity*o.price}},Je=async()=>{var o,e;if(oe.value)try{if(await oe.value.validate(),!r.value.items||r.value.items.length===0){y.warning("请至少添加一个商品");return}for(const i of r.value.items){if(!i.skuId){y.warning("商品【".concat(i.productName,"】未选择尺码"));return}if(i.quantity<=0){y.warning("数量需大于0");return}}const d={},u={};for(const i of r.value.items){const s=String(i.productId),p=Number(i.price||0),_=Number(i.quantity||0),x=Number(i.skuId);if((i.skuId||i.size&&String(i.size).trim().length>0)&&(d[s]||(d[s]=[]),d[s].push({size:String(i.size||""),qty:_,sku_id:Number.isFinite(x)?x:void 0,unit_price:p})),u[s])u[s].quantity+=_;else{const k=J.value.find(j=>String(j.id)===s),Y=Number((e=(o=F(k))!=null?o:p)!=null?e:0);u[s]={product_id:Number(s),unit_price:Y,quantity:_}}}const n=Object.values(u).map(i=>({product_id:i.product_id,unit_price:i.unit_price,quantity:i.quantity}));r.value.totalAmount=ge.value,te.value?(await B.updateSale(te.value,{customer_id:void 0,sale_date:new Date().toISOString(),sale_type:r.value.saleType||"wholesale",discount_amount:0,remark:r.value.remark||"",details:n,size_plans:d}),y.success("更新成功")):(await B.createSale({customer_id:void 0,sale_date:new Date().toISOString(),sale_type:r.value.saleType||"wholesale",discount_amount:0,remark:r.value.remark||"",details:n,size_plans:d}),y.success("添加成功")),H.value=!1,M()}catch(d){}},Ye=()=>{H.value=!1};return ll(()=>{M()}),(o,e)=>{const d=w("el-input"),u=w("el-form-item"),n=w("el-option"),i=w("el-select"),s=w("el-date-picker"),p=w("el-button"),_=w("el-form"),x=w("el-card"),k=w("el-table-column"),Y=w("el-tag"),j=w("el-dropdown-item"),Ge=w("el-dropdown-menu"),We=w("el-dropdown"),ie=w("el-table"),Xe=w("el-pagination"),O=w("el-col"),Z=w("el-row"),q=w("el-input-number"),we=w("el-dialog"),Ve=w("el-switch"),Ze=al("loading");return h(),I("div",sl,[f("div",dl,[l(x,null,{default:a(()=>[l(_,{model:S.value,inline:""},{default:a(()=>[l(u,{label:"关键词"},{default:a(()=>[l(d,{modelValue:S.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=t=>S.value.keyword=t),placeholder:"订单号/客户姓名/电话",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(u,{label:"订单状态"},{default:a(()=>[l(i,{modelValue:S.value.status,"onUpdate:modelValue":e[1]||(e[1]=t=>S.value.status=t),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:a(()=>[l(n,{label:"待确认",value:"pending"}),l(n,{label:"已确认",value:"confirmed"}),l(n,{label:"已发货",value:"shipped"}),l(n,{label:"已完成",value:"completed"}),l(n,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"付款状态"},{default:a(()=>[l(i,{modelValue:S.value.paymentStatus,"onUpdate:modelValue":e[2]||(e[2]=t=>S.value.paymentStatus=t),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:a(()=>[l(n,{label:"未付款",value:"unpaid"}),l(n,{label:"已付款",value:"paid"}),l(n,{label:"已退款",value:"refunded"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"销售类型"},{default:a(()=>[l(i,{modelValue:S.value.saleType,"onUpdate:modelValue":e[3]||(e[3]=t=>S.value.saleType=t),placeholder:"全部",clearable:"",style:{width:"120px"}},{default:a(()=>[l(n,{label:"零售",value:"retail"}),l(n,{label:"批发",value:"wholesale"}),l(n,{label:"网店",value:"online"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"日期范围"},{default:a(()=>[l(s,{modelValue:S.value.startDate,"onUpdate:modelValue":e[4]||(e[4]=t=>S.value.startDate=t),type:"date",placeholder:"开始日期",style:{width:"140px"}},null,8,["modelValue"]),e[33]||(e[33]=f("span",{style:{margin:"0 8px"}},"至",-1)),l(s,{modelValue:S.value.endDate,"onUpdate:modelValue":e[5]||(e[5]=t=>S.value.endDate=t),type:"date",placeholder:"结束日期",style:{width:"140px"}},null,8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(p,{type:"primary",onClick:ke},{icon:a(()=>[...e[34]||(e[34]=[f("i",{class:"ep:search"},null,-1)])]),default:a(()=>[e[35]||(e[35]=v(" 搜索 ",-1))]),_:1}),l(p,{onClick:Pe},{default:a(()=>[...e[36]||(e[36]=[v("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),f("div",rl,[l(x,null,{default:a(()=>[f("div",pl,[f("div",ml,[l(p,{type:"primary",onClick:De},{icon:a(()=>[...e[37]||(e[37]=[f("i",{class:"ep:plus"},null,-1)])]),default:a(()=>[e[38]||(e[38]=v(" 新增销售单 ",-1))]),_:1})]),f("div",cl,[l(p,{type:"success"},{icon:a(()=>[...e[39]||(e[39]=[f("i",{class:"ep:download"},null,-1)])]),default:a(()=>[e[40]||(e[40]=v(" 导出Excel ",-1))]),_:1})])])]),_:1})]),f("div",vl,[l(x,null,{default:a(()=>[tl((h(),ee(ie,{data:pe.value,stripe:"",style:{width:"100%"}},{default:a(()=>[l(k,{prop:"orderNo",label:"订单号",width:"150"}),l(k,{prop:"customerName",label:"客户姓名",width:"100"}),l(k,{prop:"customerPhone",label:"客户电话",width:"130"}),l(k,{prop:"totalAmount",label:"订单金额",width:"100",align:"right"},{default:a(({row:t})=>[f("span",fl,"¥"+U(t.totalAmount.toFixed(2)),1)]),_:1}),l(k,{prop:"status",label:"订单状态",width:"100",align:"center"},{default:a(({row:t})=>[l(Y,{type:ue[t.status].type,size:"small"},{default:a(()=>[v(U(ue[t.status].text),1)]),_:2},1032,["type"])]),_:1}),l(k,{prop:"paymentStatus",label:"付款状态",width:"100",align:"center"},{default:a(({row:t})=>[l(Y,{type:ye[t.paymentStatus].type,size:"small"},{default:a(()=>[v(U(ye[t.paymentStatus].text),1)]),_:2},1032,["type"])]),_:1}),l(k,{prop:"createTime",label:"创建时间",width:"150"}),l(k,{label:"操作",width:"300",fixed:"right"},{default:a(({row:t})=>[l(p,{type:"primary",size:"small",onClick:m=>Te(t)},{default:a(()=>[...e[41]||(e[41]=[v(" 编辑 ",-1)])]),_:1},8,["onClick"]),l(We,{onCommand:m=>Fe(t.id,m)},{dropdown:a(()=>[l(Ge,null,{default:a(()=>[l(j,{command:"confirmed",disabled:t.status!=="pending"},{default:a(()=>[...e[43]||(e[43]=[v(" 确认订单 ",-1)])]),_:1},8,["disabled"]),l(j,{command:"shipped",disabled:t.status!=="confirmed"},{default:a(()=>[...e[44]||(e[44]=[v(" 发货 ",-1)])]),_:1},8,["disabled"]),l(j,{command:"completed",disabled:t.status!=="shipped"},{default:a(()=>[...e[45]||(e[45]=[v(" 完成 ",-1)])]),_:1},8,["disabled"]),l(j,{command:"cancelled",disabled:["completed","cancelled"].includes(t.status)},{default:a(()=>[...e[46]||(e[46]=[v(" 取消 ",-1)])]),_:1},8,["disabled"])]),_:2},1024)]),default:a(()=>[l(p,{type:"warning",size:"small"},{default:a(()=>[...e[42]||(e[42]=[v(" 状态操作",-1),f("i",{class:"ep:arrow-down ml-1"},null,-1)])]),_:1})]),_:2},1032,["onCommand"]),l(p,{type:"danger",size:"small",onClick:m=>Ae(t.id)},{default:a(()=>[...e[47]||(e[47]=[v(" 删除 ",-1)])]),_:1},8,["onClick"]),l(p,{size:"small",onClick:()=>{const m=typeof o.localStorage<"u"&&o.localStorage.getItem("token")||"",N=m?"/api/print/picking?order_id=".concat(t.id,"&token=").concat(encodeURIComponent(m)):"/api/print/picking?order_id=".concat(t.id);o.window.open(N,"_blank")}},{default:a(()=>[...e[48]||(e[48]=[v("拣货单",-1)])]),_:1},8,["onClick"]),l(p,{size:"small",onClick:()=>{const m=typeof o.localStorage<"u"&&o.localStorage.getItem("token")||"",N=m?"/api/print/outbound?order_id=".concat(t.id,"&token=").concat(encodeURIComponent(m)):"/api/print/outbound?order_id=".concat(t.id);o.window.open(N,"_blank")}},{default:a(()=>[...e[49]||(e[49]=[v("出库单",-1)])]),_:1},8,["onClick"]),l(p,{size:"small",onClick:()=>{const m=typeof o.localStorage<"u"&&o.localStorage.getItem("token")||"",N=m?"/api/print/shipping-label?order_id=".concat(t.id,"&token=").concat(encodeURIComponent(m)):"/api/print/shipping-label?order_id=".concat(t.id);o.window.open(N,"_blank")}},{default:a(()=>[...e[50]||(e[50]=[v("面单",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Ze,P.value]]),f("div",gl,[l(Xe,{"current-page":G.value,"onUpdate:currentPage":e[6]||(e[6]=t=>G.value=t),"page-size":le.value,"onUpdate:pageSize":e[7]||(e[7]=t=>le.value=t),total:me.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:M,onCurrentChange:M},null,8,["current-page","page-size","total"])])]),_:1})]),l(we,{modelValue:H.value,"onUpdate:modelValue":e[16]||(e[16]=t=>H.value=t),title:ce.value,width:"80%","close-on-click-modal":!1},{footer:a(()=>[f("div",kl,[l(p,{onClick:Ye},{default:a(()=>[...e[54]||(e[54]=[v("取消",-1)])]),_:1}),l(p,{type:"primary",onClick:Je},{default:a(()=>[...e[55]||(e[55]=[v("保存",-1)])]),_:1})])]),default:a(()=>[l(_,{ref_key:"formRef",ref:oe,model:r.value,rules:qe,"label-width":"100px"},{default:a(()=>[l(Z,{gutter:20},{default:a(()=>[l(O,{span:12},{default:a(()=>[l(u,{label:"订单号",prop:"orderNo"},{default:a(()=>[l(d,{modelValue:r.value.orderNo,"onUpdate:modelValue":e[8]||(e[8]=t=>r.value.orderNo=t),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),l(O,{span:12},{default:a(()=>[l(u,{label:"订单状态",prop:"status"},{default:a(()=>[l(i,{modelValue:r.value.status,"onUpdate:modelValue":e[9]||(e[9]=t=>r.value.status=t),style:{width:"100%"}},{default:a(()=>[l(n,{label:"待确认",value:"pending"}),l(n,{label:"已确认",value:"confirmed"}),l(n,{label:"已发货",value:"shipped"}),l(n,{label:"已完成",value:"completed"}),l(n,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(Z,{gutter:20},{default:a(()=>[l(O,{span:12},{default:a(()=>[l(u,{label:"销售类型"},{default:a(()=>[l(i,{modelValue:r.value.saleType,"onUpdate:modelValue":e[10]||(e[10]=t=>r.value.saleType=t),style:{width:"100%"}},{default:a(()=>[l(n,{label:"零售",value:"retail"}),l(n,{label:"批发",value:"wholesale"}),l(n,{label:"网店",value:"online"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(Z,{gutter:20},{default:a(()=>[l(O,{span:12},{default:a(()=>[l(u,{label:"客户姓名",prop:"customerName"},{default:a(()=>[l(d,{modelValue:r.value.customerName,"onUpdate:modelValue":e[11]||(e[11]=t=>r.value.customerName=t),placeholder:"请输入客户姓名"},null,8,["modelValue"])]),_:1})]),_:1}),l(O,{span:12},{default:a(()=>[l(u,{label:"客户电话",prop:"customerPhone"},{default:a(()=>[l(d,{modelValue:r.value.customerPhone,"onUpdate:modelValue":e[12]||(e[12]=t=>r.value.customerPhone=t),placeholder:"请输入客户电话"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(u,{label:"客户地址",prop:"customerAddress"},{default:a(()=>[l(d,{modelValue:r.value.customerAddress,"onUpdate:modelValue":e[13]||(e[13]=t=>r.value.customerAddress=t),type:"textarea",rows:2,placeholder:"请输入客户地址"},null,8,["modelValue"])]),_:1}),l(u,{label:"付款状态",prop:"paymentStatus"},{default:a(()=>[l(i,{modelValue:r.value.paymentStatus,"onUpdate:modelValue":e[14]||(e[14]=t=>r.value.paymentStatus=t),style:{width:"200px"}},{default:a(()=>[l(n,{label:"未付款",value:"unpaid"}),l(n,{label:"已付款",value:"paid"}),l(n,{label:"已退款",value:"refunded"})]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"商品列表"},{default:a(()=>[f("div",yl,[f("div",bl,[l(p,{type:"primary",onClick:Ee},{icon:a(()=>[...e[51]||(e[51]=[f("i",{class:"ep:plus"},null,-1)])]),default:a(()=>[e[52]||(e[52]=v(" 添加商品 ",-1))]),_:1})]),l(ie,{data:r.value.items,style:{width:"100%","margin-top":"16px"}},{default:a(()=>[l(k,{prop:"productName",label:"商品名称"}),l(k,{prop:"size",label:"尺码",width:"160"},{default:a(({row:t})=>[l(i,{size:"small","model-value":t.skuId,onChange:m=>He(t,m),style:{width:"140px"},placeholder:t.size||"选择尺码"},{default:a(()=>[(h(!0),I(se,null,de(T.value[t.productId]||[],m=>{var N;return h(),ee(n,{key:m.id,value:String(m.id),label:"".concat(m.size).concat(m.status==="disabled"?"(停用)":""," / 库存:").concat((N=m.stock)!=null?N:0),disabled:m.status==="disabled"},null,8,["value","label","disabled"])}),128))]),_:2},1032,["model-value","onChange","placeholder"])]),_:1}),l(k,{prop:"price",label:"单价",width:"140",align:"right"},{default:a(({row:t})=>[l(q,{modelValue:t.price,"onUpdate:modelValue":m=>t.price=m,min:0,step:1,size:"small",style:{width:"120px"},onChange:()=>je(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(k,{prop:"quantity",label:"数量",width:"140",align:"center"},{default:a(({row:t})=>[l(q,{modelValue:t.quantity,"onUpdate:modelValue":m=>t.quantity=m,min:0,step:1,size:"small",style:{width:"120px"},onChange:()=>Qe(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),l(k,{prop:"subtotal",label:"小计",width:"140",align:"right"},{default:a(({row:t})=>[v(" ¥"+U((t.quantity*t.price).toFixed(2)),1)]),_:1}),l(k,{label:"操作",width:"80"},{default:a(({$index:t})=>[l(p,{type:"danger",size:"small",onClick:m=>Le(t)},{default:a(()=>[...e[53]||(e[53]=[v(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),f("div",_l,[f("strong",null,"总金额: ¥"+U(ge.value.toFixed(2)),1)])])]),_:1}),l(u,{label:"备注",prop:"remark"},{default:a(()=>[l(d,{modelValue:r.value.remark,"onUpdate:modelValue":e[15]||(e[15]=t=>r.value.remark=t),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(we,{modelValue:ae.value,"onUpdate:modelValue":e[32]||(e[32]=t=>ae.value=t),title:"选择商品与尺码",width:"70%"},{default:a(()=>[l(Z,{gutter:16},{default:a(()=>[l(O,{span:12},{default:a(()=>[l(ie,{height:"420",data:J.value,onRowClick:Me,"highlight-current-row":""},{default:a(()=>[l(k,{prop:"name",label:"商品名称"}),l(k,{prop:"category",label:"分类",width:"100"}),l(k,{prop:"price",label:"价格",width:"100",align:"right"},{default:a(({row:t})=>{var m;return[r.value.saleType==="wholesale"?(h(),I("span",Sl,"批发: ¥"+U(((m=t.wholesale_price)!=null?m:t.price).toFixed(2)),1)):(h(),I("span",wl,"零售: ¥"+U(t.price.toFixed(2)),1))]}),_:1}),l(k,{prop:"stock",label:"总库存",width:"90",align:"right"})]),_:1},8,["data"])]),_:1}),l(O,{span:12},{default:a(()=>[g.value?(h(),I("div",Vl,[f("div",null,"已选商品："+U(g.value.name),1),f("div",null,[l(Ve,{modelValue:A.value,"onUpdate:modelValue":e[17]||(e[17]=t=>A.value=t),"active-text":"批量模式","inactive-text":"单选模式"},null,8,["modelValue"])])])):K("",!0),l(_,{inline:""},{default:a(()=>[l(u,{label:"条码"},{default:a(()=>[l(d,{modelValue:E.value,"onUpdate:modelValue":e[18]||(e[18]=t=>E.value=t),placeholder:"扫描/输入条码后回车",style:{width:"220px"},onKeyup:ol(ul(Oe,["stop"]),["enter","native"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1}),f("div",hl,[(h(!0),I(se,null,de(z.value,t=>{var m,N;return h(),I("div",{key:t.id,class:nl(["sku-item",{active:String(t.id)===String(R.value),disabled:t.status==="disabled"}]),onClick:he=>!A.value&&t.status!=="disabled"&&Se(t)},[f("div",Cl,U(t.size),1),f("div",Nl,"库存："+U((m=t.stock)!=null?m:0),1),f("div",Il,"¥"+U(F(g.value).toFixed(2)),1),A.value?(h(),I("div",Ul,[l(q,{modelValue:L.value[String(t.id)],"onUpdate:modelValue":he=>L.value[String(t.id)]=he,min:0,max:(N=t.stock)!=null?N:9999,step:1,size:"small",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue","max"])])):K("",!0)],10,xl)}),128))]),g.value&&z.value.length===0?(h(),I("div",zl,[e[57]||(e[57]=f("div",{style:{"margin-bottom":"8px",color:"#e6a23c"}},"该商品暂未设置SKU（尺码），可直接按商品加入明细",-1)),l(_,{"label-width":"60px",inline:""},{default:a(()=>[l(u,{label:"数量"},{default:a(()=>[l(q,{modelValue:C.value,"onUpdate:modelValue":e[19]||(e[19]=t=>C.value=t),min:1,step:1,style:{width:"120px"}},null,8,["modelValue"])]),_:1}),l(u,{label:"单价"},{default:a(()=>[l(q,{modelValue:$.value,"onUpdate:modelValue":e[20]||(e[20]=t=>$.value=t),min:0,step:1,style:{width:"140px"}},null,8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(p,{type:"primary",onClick:fe},{default:a(()=>[...e[56]||(e[56]=[v("加入明细（无尺码）",-1)])]),_:1})]),_:1})]),_:1})])):K("",!0),W.value&&!A.value?(h(),I("div",$l,[l(_,{"label-width":"60px",inline:""},{default:a(()=>[l(u,{label:"尺码"},{default:a(()=>[l(Y,{type:"info"},{default:a(()=>{var t;return[v(U((t=W.value)==null?void 0:t.size),1)]}),_:1})]),_:1}),l(u,{label:"数量"},{default:a(()=>{var t,m;return[l(q,{modelValue:C.value,"onUpdate:modelValue":e[21]||(e[21]=N=>C.value=N),min:1,max:(m=(t=W.value)==null?void 0:t.stock)!=null?m:9999,style:{width:"120px"}},null,8,["modelValue","max"])]}),_:1}),l(u,{label:"单价"},{default:a(()=>[l(q,{modelValue:$.value,"onUpdate:modelValue":e[22]||(e[22]=t=>$.value=t),min:0,step:1,style:{width:"140px"}},null,8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(p,{type:"primary",onClick:Ke},{default:a(()=>[...e[58]||(e[58]=[v("加入明细",-1)])]),_:1})]),_:1})]),_:1})])):K("",!0),A.value?(h(),I("div",ql,[l(p,{type:"primary",onClick:Re},{default:a(()=>[...e[59]||(e[59]=[v("批量加入明细",-1)])]),_:1})])):K("",!0)]),_:1})]),_:1}),f("div",Pl,[l(p,{type:"primary",link:"",onClick:e[23]||(e[23]=t=>Q.value=!Q.value)},{default:a(()=>[v(U(Q.value?"收起":"快速新增商品"),1)]),_:1})]),Q.value?(h(),ee(x,{key:0,class:"box-card",shadow:"never",style:{"margin-bottom":"10px"}},{default:a(()=>[l(_,{model:c.value,"label-width":"90px"},{default:a(()=>[l(u,{label:"名称"},{default:a(()=>[l(d,{modelValue:c.value.name,"onUpdate:modelValue":e[24]||(e[24]=t=>c.value.name=t),placeholder:"商品名称"},null,8,["modelValue"])]),_:1}),l(u,{label:"分类"},{default:a(()=>[l(i,{modelValue:c.value.category,"onUpdate:modelValue":e[25]||(e[25]=t=>c.value.category=t),placeholder:"选择分类",filterable:""},{default:a(()=>[(h(!0),I(se,null,de(X.value,t=>(h(),ee(n,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(u,{label:"批发价"},{default:a(()=>[l(q,{modelValue:c.value.wholesale_price,"onUpdate:modelValue":e[26]||(e[26]=t=>c.value.wholesale_price=t),min:0,step:1},null,8,["modelValue"])]),_:1}),l(u,{label:"零售价"},{default:a(()=>[l(q,{modelValue:c.value.retail_price,"onUpdate:modelValue":e[27]||(e[27]=t=>c.value.retail_price=t),min:0,step:1},null,8,["modelValue"])]),_:1}),l(u,{label:"生成SKU"},{default:a(()=>[l(Ve,{modelValue:c.value.genSkus,"onUpdate:modelValue":e[28]||(e[28]=t=>c.value.genSkus=t)},null,8,["modelValue"]),c.value.genSkus?(h(),I("div",Dl,[l(i,{modelValue:c.value.skuTemplate,"onUpdate:modelValue":e[29]||(e[29]=t=>c.value.skuTemplate=t),style:{width:"130px"}},{default:a(()=>[l(n,{label:"服装尺码",value:"apparel"}),l(n,{label:"通码(ONE)",value:"one"})]),_:1},8,["modelValue"]),l(d,{modelValue:c.value.baseBarcode,"onUpdate:modelValue":e[30]||(e[30]=t=>c.value.baseBarcode=t),placeholder:"条码前缀(可选)",style:{width:"180px"}},null,8,["modelValue"]),l(q,{modelValue:c.value.initStock,"onUpdate:modelValue":e[31]||(e[31]=t=>c.value.initStock=t),min:0,step:1,placeholder:"初始库存"},null,8,["modelValue"])])):K("",!0)]),_:1}),l(u,null,{default:a(()=>[l(p,{type:"primary",onClick:$e},{default:a(()=>[...e[60]||(e[60]=[v("保存并选中",-1)])]),_:1}),l(p,{onClick:ve},{default:a(()=>[...e[61]||(e[61]=[v("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})):K("",!0)]),_:1},8,["modelValue"])])}}});typeof Ne=="function"&&Ne(Ue);const Fl=il(Ue,[["__scopeId","data-v-b2355b00"]]);export{Fl as default};
