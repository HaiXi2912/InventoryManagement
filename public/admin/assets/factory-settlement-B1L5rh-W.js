
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{F as k}from"./finance-DW_c61TG.js";import{d as $,r as u,A as ee,J as le,O as ae,c as te,f as l,w as t,E as z,i,o as oe,e as p,h as d,t as f,v as ne,x as T}from"./index-CdiJTMf6.js";const se={class:"p-4 space-y-4"},ue={class:"flex items-center justify-between flex-wrap gap-2"},de={class:"space-x-2"},ie={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},pe={class:"mt-3 flex items-center gap-2 flex-wrap"},re={class:"mt-3 flex items-center gap-2 flex-wrap"},me={class:"flex items-center justify-between flex-wrap gap-2"},ve={class:"space-x-2"},ce={class:"flex justify-end mt-2"},J=$({__name:"factory-settlement",setup(fe){const M=u(!1),b=u(new Date().toISOString().split("T")[0]),g=u(new Date().toISOString().slice(0,7)),D=u(null),R=u(null),w=u(null),A=u("transfer"),P=u(""),V=u(null),Y=u("transfer"),F=u(""),I=u([]),r=u({page:1,size:10,total:0}),x=u({});function L(o){return Number(o||0)}function h(o){return L(o).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}async function S(){M.value=!0;try{const[o,e]=await Promise.all([k.getDaily(b.value),k.getMonthly(g.value)]);D.value=(o==null?void 0:o.data)||null,R.value=(e==null?void 0:e.data)||null}catch(o){z.error("加载摘要失败")}finally{M.value=!1}}async function q(){var o,e;try{const n={date:b.value,method:A.value,remark:P.value};w.value&&w.value>0&&(n.amount=w.value);const m=await k.settleDaily(n);z.success("日清结算成功"),await S(),await _()}catch(n){z.error(((e=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:e.message)||"日清结算失败")}}async function G(){var o,e;try{const n={period:g.value,method:Y.value,remark:F.value};V.value&&V.value>0&&(n.amount=V.value);const m=await k.settleMonthly(n);z.success("月结结算成功"),await S(),await _()}catch(n){z.error(((e=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:e.message)||"月结结算失败")}}async function _(){var o,e,n;try{const{page:m,size:c}=r.value,U={page:m,size:c,...x.value},v=await k.getFactoryPayments(U);I.value=((o=v==null?void 0:v.data)==null?void 0:o.list)||[],r.value.total=((n=(e=v==null?void 0:v.data)==null?void 0:e.pagination)==null?void 0:n.total)||0}catch(m){I.value=[]}}function H(o){r.value.page=o,_()}function K(o){r.value.size=o,_()}return ee(async()=>{await S(),await _()}),(o,e)=>{const n=i("el-date-picker"),m=i("el-button"),c=i("el-descriptions-item"),U=i("el-descriptions"),v=i("el-input-number"),s=i("el-option"),j=i("el-select"),N=i("el-input"),C=i("el-card"),y=i("el-table-column"),Q=i("el-tag"),W=i("el-table"),X=i("el-pagination"),Z=ae("loading");return le((oe(),te("div",se,[l(C,null,{header:t(()=>[p("div",ue,[e[13]||(e[13]=p("div",{class:"font-600"},"工厂结算",-1)),p("div",de,[l(n,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),type:"date","value-format":"YYYY-MM-DD",placeholder:"选择日清日期"},null,8,["modelValue"]),l(n,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=a=>g.value=a),type:"month","value-format":"YYYY-MM",placeholder:"选择月份"},null,8,["modelValue"]),l(m,{size:"small",onClick:S},{default:t(()=>[...e[12]||(e[12]=[d("刷新",-1)])]),_:1})])])]),default:t(()=>[p("div",ie,[l(C,{shadow:"never"},{header:t(()=>[...e[14]||(e[14]=[d("日清结算",-1)])]),default:t(()=>[l(U,{column:1,size:"small",border:""},{default:t(()=>[l(c,{label:"日清日期"},{default:t(()=>[d(f(b.value),1)]),_:1}),l(c,{label:"应付基数(完成)"},{default:t(()=>{var a;return[d("¥"+f(h((a=D.value)==null?void 0:a.total_factory_cost)),1)]}),_:1}),l(c,{label:"AP/AR"},{default:t(()=>{var a,B,E,O;return[d("AP: ¥"+f(h((B=(a=D.value)==null?void 0:a.breakdown)==null?void 0:B.ap))+"，AR: ¥"+f(h((O=(E=D.value)==null?void 0:E.breakdown)==null?void 0:O.ar)),1)]}),_:1})]),_:1}),p("div",pe,[l(v,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=a=>w.value=a),min:0,step:100,placeholder:"金额(留空=按基数)"},null,8,["modelValue"]),l(j,{modelValue:A.value,"onUpdate:modelValue":e[3]||(e[3]=a=>A.value=a),placeholder:"方式",style:{width:"140px"}},{default:t(()=>[l(s,{label:"转账",value:"transfer"}),l(s,{label:"现金",value:"cash"}),l(s,{label:"银行卡",value:"card"}),l(s,{label:"支付宝",value:"alipay"}),l(s,{label:"微信",value:"wechat"}),l(s,{label:"其他",value:"other"})]),_:1},8,["modelValue"]),l(N,{modelValue:P.value,"onUpdate:modelValue":e[4]||(e[4]=a=>P.value=a),placeholder:"备注",style:{width:"240px"}},null,8,["modelValue"]),l(m,{type:"primary",onClick:q},{default:t(()=>[...e[15]||(e[15]=[d("去结算",-1)])]),_:1})]),e[16]||(e[16]=p("div",{class:"tip"},"不填金额默认按“应付基数”结算",-1))]),_:1}),l(C,{shadow:"never"},{header:t(()=>[...e[17]||(e[17]=[d("月结结算",-1)])]),default:t(()=>[l(U,{column:1,size:"small",border:""},{default:t(()=>[l(c,{label:"结算月份"},{default:t(()=>[d(f(g.value),1)]),_:1}),l(c,{label:"应付基数(完成)"},{default:t(()=>{var a;return[d("¥"+f(h((a=R.value)==null?void 0:a.total_factory_cost)),1)]}),_:1}),l(c,{label:"扣除说明"},{default:t(()=>[...e[18]||(e[18]=[d("若今日已做日清，将自动扣除今日金额",-1)])]),_:1})]),_:1}),p("div",re,[l(v,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=a=>V.value=a),min:0,step:100,placeholder:"金额(留空=基数-当日已结)"},null,8,["modelValue"]),l(j,{modelValue:Y.value,"onUpdate:modelValue":e[6]||(e[6]=a=>Y.value=a),placeholder:"方式",style:{width:"140px"}},{default:t(()=>[l(s,{label:"转账",value:"transfer"}),l(s,{label:"现金",value:"cash"}),l(s,{label:"银行卡",value:"card"}),l(s,{label:"支付宝",value:"alipay"}),l(s,{label:"微信",value:"wechat"}),l(s,{label:"其他",value:"other"})]),_:1},8,["modelValue"]),l(N,{modelValue:F.value,"onUpdate:modelValue":e[7]||(e[7]=a=>F.value=a),placeholder:"备注",style:{width:"240px"}},null,8,["modelValue"]),l(m,{type:"primary",onClick:G},{default:t(()=>[...e[19]||(e[19]=[d("去结算",-1)])]),_:1})]),e[20]||(e[20]=p("div",{class:"tip"},"不填金额默认按“应付基数-当日已结”结算",-1))]),_:1})])]),_:1}),l(C,null,{header:t(()=>[p("div",me,[e[22]||(e[22]=p("div",{class:"font-600"},"结算记录",-1)),p("div",ve,[l(j,{modelValue:x.value.scope_type,"onUpdate:modelValue":e[8]||(e[8]=a=>x.value.scope_type=a),placeholder:"全部类型",clearable:"",style:{width:"120px"}},{default:t(()=>[l(s,{label:"日清",value:"daily"}),l(s,{label:"月结",value:"monthly"})]),_:1},8,["modelValue"]),l(N,{modelValue:x.value.scope_value,"onUpdate:modelValue":e[9]||(e[9]=a=>x.value.scope_value=a),placeholder:"日期或月份",clearable:"",style:{width:"180px"}},null,8,["modelValue"]),l(m,{size:"small",onClick:_},{default:t(()=>[...e[21]||(e[21]=[d("查询",-1)])]),_:1})])])]),default:t(()=>[l(W,{data:I.value,size:"small",stripe:""},{default:t(()=>[l(y,{prop:"id",label:"ID",width:"70"}),l(y,{prop:"scope_type",label:"类型",width:"100"},{default:t(({row:a})=>[l(Q,{size:"small",type:a.scope_type==="daily"?"primary":"success"},{default:t(()=>[d(f(a.scope_type==="daily"?"日清":"月结"),1)]),_:2},1032,["type"])]),_:1}),l(y,{prop:"scope_value",label:"范围",width:"140"}),l(y,{prop:"amount",label:"金额(¥)",width:"140"},{default:t(({row:a})=>[d(f(h(a.amount)),1)]),_:1}),l(y,{prop:"method",label:"方式",width:"120"}),l(y,{prop:"paid_at",label:"支付时间",width:"180"}),l(y,{prop:"remark",label:"备注"})]),_:1},8,["data"]),p("div",ce,[l(X,{layout:"total, sizes, prev, pager, next, jumper",total:r.value.total,"page-size":r.value.size,"onUpdate:pageSize":e[10]||(e[10]=a=>r.value.size=a),"current-page":r.value.page,"onUpdate:currentPage":e[11]||(e[11]=a=>r.value.page=a),onSizeChange:K,onCurrentChange:H},null,8,["total","page-size","current-page"])])]),_:1})])),[[Z,M.value]])}}});typeof T=="function"&&T(J);const be=ne(J,[["__scopeId","data-v-d69e9c2f"]]);export{be as default};
