
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as it,r as m,A as lt,c as G,J as ct,O as dt,e,f as a,w as c,s as ut,i as J,o as X,_ as mt,t as f,h as w,v as vt,x as j}from"./index-CdiJTMf6.js";import{S as A,i as F}from"./statistics-0DC4hwkI.js";const pt={class:"inventory-dashboard"},_t={class:"dashboard-content"},ft={class:"metrics-grid"},yt={class:"metric-content"},ht={class:"metric-icon"},gt={class:"metric-info"},bt={class:"metric-value"},wt={class:"metric-sub"},St={class:"metric-content"},xt={class:"metric-icon"},kt={class:"metric-info"},Ct={class:"metric-value"},zt={class:"metric-sub"},Dt={class:"metric-content"},Ot={class:"metric-icon"},At={class:"metric-info"},Ft={class:"metric-value"},It={class:"metric-sub"},Nt={class:"metric-content"},Rt={class:"metric-icon"},Pt={class:"metric-info"},Mt={class:"metric-value"},Et={class:"charts-grid"},Lt={class:"quick-actions"},Vt={class:"action-buttons"},K=it({__name:"dashboard",setup(Tt){function S(n){const t=n.getFullYear(),r=String(n.getMonth()+1).padStart(2,"0"),s=String(n.getDate()).padStart(2,"0");return"".concat(t,"-").concat(r,"-").concat(s)}function Q(n,t){const r=[],s=new Date(n),d=new Date(t);for(s.setHours(0,0,0,0),d.setHours(0,0,0,0);s.getTime()<=d.getTime();)r.push(S(s)),s.setDate(s.getDate()+1);return r}const l=m({totalSales:0,todaySales:0,totalOrders:0,todayOrders:0,totalProducts:0,lowStockProducts:0,totalInventoryValue:0}),x=m(!0),h=m([]),k=m({purchase:0,sale:0}),g=m({low:0,zero:0,over:0}),C=m(),z=m(),D=m();let v,p,_;async function U(){var n,t,r,s,d,b,I,N,R,P,M,E,L,V;x.value=!0;try{const y=new Date,T=S(new Date(y.getFullYear(),y.getMonth(),1)),B=S(y),o=(await A.getOverview({start_date:T,end_date:B})).data,$=o.sale_stats||[],st=o.purchase_stats||[],Y=$.reduce((i,u)=>i+parseFloat(u.total_amount||0),0),ot=$.reduce((i,u)=>i+parseInt(u.count||0),0),rt=st.reduce((i,u)=>i+parseFloat(u.total_amount||0),0);l.value.totalSales=Y,l.value.totalOrders=ot,l.value.totalProducts=Number(((n=o==null?void 0:o.basic_info)==null?void 0:n.total_products)||0),l.value.lowStockProducts=Number(((t=o==null?void 0:o.basic_info)==null?void 0:t.low_stock_count)||0),l.value.totalInventoryValue=Number(((r=o==null?void 0:o.basic_info)==null?void 0:r.total_inventory_value)||0),l.value.todaySales=Number(((d=(s=o==null?void 0:o.today_summary)==null?void 0:s.sale)==null?void 0:d.amount)||0),l.value.todayOrders=Number(((I=(b=o==null?void 0:o.today_summary)==null?void 0:b.sale)==null?void 0:I.count)||0),k.value={purchase:rt,sale:Y};const nt=await A.getMonthly({year:y.getFullYear(),month:y.getMonth()+1}),H=Q(T,B),q=new Map;(((N=nt.data)==null?void 0:N.daily_trend)||[]).filter(i=>i.type==="sale").forEach(i=>{const u=String(i.date).slice(0,10);q.set(u,{sales:parseFloat(i.amount||0),orders:parseInt(i.count||0)})}),h.value=H.map(i=>q.get(i)||{sales:0,orders:0}).map((i,u)=>({date:H[u],...i}));const O=await A.getInventoryAlerts();g.value={low:Number(((P=(R=O.data)==null?void 0:R.low_stock)==null?void 0:P.count)||0),zero:Number(((E=(M=O.data)==null?void 0:M.zero_stock)==null?void 0:E.count)||0),over:Number(((V=(L=O.data)==null?void 0:L.over_stock)==null?void 0:V.count)||0)},await ut(),W(),Z()}finally{x.value=!1}}function W(){C.value&&!v&&(v=F(C.value)),z.value&&!p&&(p=F(z.value)),D.value&&!_&&(_=F(D.value)),window.addEventListener("resize",()=>{v==null||v.resize(),p==null||p.resize(),_==null||_.resize()})}function Z(){tt(),et(),at()}function tt(){if(!v)return;const n={title:{text:"销售趋势",left:"2%"},tooltip:{trigger:"axis"},legend:{top:"8%",data:["销售额","订单数"]},grid:{left:"3%",right:"4%",bottom:"3%",top:"20%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:h.value.map(t=>t.date.slice(5))},yAxis:[{type:"value",name:"销售额 (元)",position:"left"},{type:"value",name:"订单数",position:"right"}],series:[{name:"销售额",type:"line",smooth:!0,yAxisIndex:0,itemStyle:{color:"#409EFF"},data:h.value.map(t=>t.sales)},{name:"订单数",type:"line",smooth:!0,yAxisIndex:1,itemStyle:{color:"#67C23A"},data:h.value.map(t=>t.orders)}]};v.setOption(n)}function et(){if(!p)return;const n={title:{text:"进销金额占比（当月）",left:"center"},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left",top:"15%"},series:[{name:"金额",type:"pie",radius:"55%",center:["60%","50%"],data:[{value:k.value.sale,name:"销售额"},{value:k.value.purchase,name:"进货额"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0,0,0,0.5)"}}}]};p.setOption(n)}function at(){if(!_)return;const n={title:{text:"库存预警分布",left:"2%"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",top:"15%",containLabel:!0},xAxis:{type:"category",data:["低库存","零库存","超库存"]},yAxis:{type:"value",name:"商品数"},series:[{name:"数量",type:"bar",data:[g.value.low,g.value.zero,g.value.over],itemStyle:{color:t=>["#E6A23C","#F56C6C","#409EFF"][t.dataIndex]||"#909399"}}]};_.setOption(n)}return lt(()=>{U()}),(n,t)=>{const r=mt,s=J("el-card"),d=J("el-button"),b=dt("loading");return X(),G("div",pt,[ct((X(),G("div",_t,[e("div",ft,[a(s,{class:"metric-card sales"},{default:c(()=>[e("div",yt,[e("div",ht,[a(r,{name:"i-ep:money",size:"32"})]),e("div",gt,[e("div",bt,"¥"+f(l.value.totalSales.toLocaleString()),1),t[0]||(t[0]=e("div",{class:"metric-label"},"总销售额",-1)),e("div",wt,"今日: ¥"+f(l.value.todaySales.toLocaleString()),1)])])]),_:1}),a(s,{class:"metric-card orders"},{default:c(()=>[e("div",St,[e("div",xt,[a(r,{name:"i-ep:shopping-cart",size:"32"})]),e("div",kt,[e("div",Ct,f(l.value.totalOrders),1),t[1]||(t[1]=e("div",{class:"metric-label"},"总订单数",-1)),e("div",zt,"今日: "+f(l.value.todayOrders),1)])])]),_:1}),a(s,{class:"metric-card products"},{default:c(()=>[e("div",Dt,[e("div",Ot,[a(r,{name:"i-ep:box",size:"32"})]),e("div",At,[e("div",Ft,f(l.value.totalProducts),1),t[2]||(t[2]=e("div",{class:"metric-label"},"商品总数",-1)),e("div",It,"低库存: "+f(l.value.lowStockProducts),1)])])]),_:1}),a(s,{class:"metric-card customers"},{default:c(()=>[e("div",Nt,[e("div",Rt,[a(r,{name:"i-ep:trend-charts",size:"32"})]),e("div",Pt,[e("div",Mt,"¥"+f(l.value.totalInventoryValue.toLocaleString()),1),t[3]||(t[3]=e("div",{class:"metric-label"},"库存总价值",-1)),t[4]||(t[4]=e("div",{class:"metric-sub"},"数据来自库存估值",-1))])])]),_:1})]),e("div",Et,[a(s,{class:"chart-card"},{default:c(()=>[e("div",{ref_key:"salesChartRef",ref:C,class:"chart-container"},null,512)]),_:1}),a(s,{class:"chart-card"},{default:c(()=>[e("div",{ref_key:"categoryChartRef",ref:z,class:"chart-container"},null,512)]),_:1}),a(s,{class:"chart-card full-width"},{default:c(()=>[e("div",{ref_key:"stockChartRef",ref:D,class:"chart-container"},null,512)]),_:1})]),e("div",Lt,[a(s,null,{header:c(()=>[...t[5]||(t[5]=[e("div",{class:"card-header"},[e("span",null,"快速操作")],-1)])]),default:c(()=>[e("div",Vt,[a(d,{type:"primary",size:"large"},{default:c(()=>[a(r,{name:"i-ep:plus"}),t[6]||(t[6]=w(" 添加商品 ",-1))]),_:1}),a(d,{type:"success",size:"large"},{default:c(()=>[a(r,{name:"i-ep:upload"}),t[7]||(t[7]=w(" 入库管理 ",-1))]),_:1}),a(d,{type:"warning",size:"large"},{default:c(()=>[a(r,{name:"i-ep:download"}),t[8]||(t[8]=w(" 出库管理 ",-1))]),_:1}),a(d,{type:"info",size:"large"},{default:c(()=>[a(r,{name:"i-ep:document-add"}),t[9]||(t[9]=w(" 生成报表 ",-1))]),_:1})])]),_:1})])])),[[b,x.value]])])}}});typeof j=="function"&&j(K);const Ht=vt(K,[["__scopeId","data-v-014b907a"]]);export{Ht as default};
