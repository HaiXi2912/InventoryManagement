
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as Y,r as i,A as Z,c as k,f as l,w as t,P as E,E as g,i as s,o as w,g as ee,Q as le,R as $,S as B,h as d,_ as ae,J as te,e as ue,O as oe,I as ne,t as j,U as se,v as ie,x as A}from"./index-CdiJTMf6.js";const de={class:"customers-page"},re={class:"pagination"},J=Y({__name:"customers",setup(pe){const N=i(!1),D=i([]),P=i(0),V=i(1),F=i(10),x=i(""),C=i(""),U=i(""),I=[{label:"零售",value:"retail"},{label:"渠道",value:"channel"},{label:"VIP",value:"vip"}],M=[{label:"启用",value:"active"},{label:"禁用",value:"inactive"}];async function p(){N.value=!0;try{const u=await E.get("/customers",{params:{page:V.value,limit:F.value,keyword:x.value||void 0,type:C.value||void 0,status:U.value||void 0}});if(u.success)D.value=u.data.items,P.value=u.data.pagination.total;else throw new Error(u.message||"加载失败")}catch(u){g.error((u==null?void 0:u.message)||"加载失败")}finally{N.value=!1}}function O(){x.value="",C.value="",U.value="",V.value=1,p()}const y=i(!1),z=i(!1),o=i({customer_type:"retail",status:"active"});function Q(){z.value=!1,o.value={customer_type:"retail",status:"active"},y.value=!0}function R(u){z.value=!0,o.value={...u},y.value=!0}async function T(){try{if(z.value)await E.put("/customers/".concat(o.value.id),o.value),g.success("已保存");else{if(!o.value.name){g.warning("请输入姓名");return}await E.post("/customers",o.value),g.success("已创建")}y.value=!1,p()}catch(u){g.error((u==null?void 0:u.message)||"提交失败")}}async function q(u){var a,m,n;try{const{value:v}=await se.prompt("输入调整金额：正数充值，负数扣减","余额调整",{inputPattern:/^-?\d+(?:\.\d{1,2})?$/,inputErrorMessage:"金额格式不正确"}),f=Number(v),c=await E.post("/customers/".concat(u.id,"/wallet/adjust"),{amount:f,type:f>0?"recharge":"adjust",remark:"后台调账"});u.wallet_balance=Number((n=(m=(a=c==null?void 0:c.data)==null?void 0:a.balance)!=null?m:u.wallet_balance)!=null?n:0),g.success("余额：".concat((u.wallet_balance||0).toFixed(2)))}catch(v){}}return Z(p),(u,a)=>{const m=s("el-input"),n=s("el-form-item"),v=s("el-option"),f=s("el-select"),c=ae,_=s("el-button"),K=s("el-form"),L=s("el-card"),r=s("el-table-column"),h=s("el-tag"),G=s("el-table"),H=s("el-pagination"),W=s("el-dialog"),X=oe("loading");return w(),k("div",de,[l(L,{shadow:"never",class:"mb-2"},{default:t(()=>[l(K,{inline:"",onSubmit:a[3]||(a[3]=ee(()=>{},["prevent"]))},{default:t(()=>[l(n,{label:"关键字"},{default:t(()=>[l(m,{modelValue:x.value,"onUpdate:modelValue":a[0]||(a[0]=e=>x.value=e),placeholder:"姓名/编码/手机",style:{width:"220px"},clearable:"",onKeyup:le(p,["enter","native"])},null,8,["modelValue"])]),_:1}),l(n,{label:"类型"},{default:t(()=>[l(f,{modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=e=>C.value=e),clearable:"",style:{width:"160px"}},{default:t(()=>[(w(),k($,null,B(I,e=>l(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"状态"},{default:t(()=>[l(f,{modelValue:U.value,"onUpdate:modelValue":a[2]||(a[2]=e=>U.value=e),clearable:"",style:{width:"140px"}},{default:t(()=>[(w(),k($,null,B(M,e=>l(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(n,null,{default:t(()=>[l(_,{type:"primary",onClick:p},{default:t(()=>[l(c,{name:"i-ep:search"}),a[14]||(a[14]=d(" 查询",-1))]),_:1}),l(_,{onClick:O},{default:t(()=>[l(c,{name:"i-ep:refresh"}),a[15]||(a[15]=d(" 重置",-1))]),_:1}),l(_,{type:"success",onClick:Q},{default:t(()=>[l(c,{name:"i-ep:plus"}),a[16]||(a[16]=d(" 新建用户",-1))]),_:1})]),_:1})]),_:1})]),_:1}),l(L,{shadow:"never"},{default:t(()=>[te((w(),ne(G,{data:D.value,border:"",stripe:"",style:{width:"100%"}},{default:t(()=>[l(r,{prop:"id",label:"ID",width:"70"}),l(r,{prop:"name",label:"姓名","min-width":"120"}),l(r,{prop:"code",label:"编码",width:"120"}),l(r,{prop:"phone",label:"手机",width:"120"}),l(r,{prop:"email",label:"邮箱","min-width":"160"}),l(r,{prop:"customer_type",label:"类型",width:"100"},{default:t(({row:e})=>[l(h,null,{default:t(()=>{var b;return[d(j(((b=I.find(S=>S.value===e.customer_type))==null?void 0:b.label)||e.customer_type),1)]}),_:2},1024)]),_:1}),l(r,{prop:"wallet_balance",label:"余额",width:"120"},{default:t(({row:e})=>[d("¥"+j(Number(e.wallet_balance||0).toFixed(2)),1)]),_:1}),l(r,{prop:"status",label:"状态",width:"100"},{default:t(({row:e})=>[l(h,{type:e.status==="active"?"success":"info"},{default:t(()=>{var b;return[d(j(((b=M.find(S=>S.value===e.status))==null?void 0:b.label)||e.status),1)]}),_:2},1032,["type"])]),_:1}),l(r,{label:"操作",width:"260",fixed:"right"},{default:t(({row:e})=>[l(_,{size:"small",type:"primary",onClick:b=>R(e)},{default:t(()=>[...a[17]||(a[17]=[d("编辑",-1)])]),_:1},8,["onClick"]),l(_,{size:"small",type:"warning",onClick:b=>q(e)},{default:t(()=>[...a[18]||(a[18]=[d("余额调整",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[X,N.value]]),ue("div",re,[l(H,{"current-page":V.value,"onUpdate:currentPage":a[4]||(a[4]=e=>V.value=e),"page-size":F.value,"onUpdate:pageSize":a[5]||(a[5]=e=>F.value=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:P.value,onCurrentChange:p,onSizeChange:a[6]||(a[6]=()=>{V.value=1,p()})},null,8,["current-page","page-size","total"])])]),_:1}),l(W,{modelValue:y.value,"onUpdate:modelValue":a[13]||(a[13]=e=>y.value=e),title:z.value?"编辑散户":"新建散户",width:"560px","close-on-click-modal":!1},{footer:t(()=>[l(_,{onClick:a[12]||(a[12]=e=>y.value=!1)},{default:t(()=>[...a[19]||(a[19]=[d("取消",-1)])]),_:1}),l(_,{type:"primary",onClick:T},{default:t(()=>[...a[20]||(a[20]=[d("保存",-1)])]),_:1})]),default:t(()=>[l(K,{"label-width":"100px"},{default:t(()=>[l(n,{label:"姓名"},{default:t(()=>[l(m,{modelValue:o.value.name,"onUpdate:modelValue":a[7]||(a[7]=e=>o.value.name=e)},null,8,["modelValue"])]),_:1}),l(n,{label:"手机"},{default:t(()=>[l(m,{modelValue:o.value.phone,"onUpdate:modelValue":a[8]||(a[8]=e=>o.value.phone=e)},null,8,["modelValue"])]),_:1}),l(n,{label:"邮箱"},{default:t(()=>[l(m,{modelValue:o.value.email,"onUpdate:modelValue":a[9]||(a[9]=e=>o.value.email=e)},null,8,["modelValue"])]),_:1}),l(n,{label:"类型"},{default:t(()=>[l(f,{modelValue:o.value.customer_type,"onUpdate:modelValue":a[10]||(a[10]=e=>o.value.customer_type=e),style:{width:"200px"}},{default:t(()=>[(w(),k($,null,B(I,e=>l(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"状态"},{default:t(()=>[l(f,{modelValue:o.value.status,"onUpdate:modelValue":a[11]||(a[11]=e=>o.value.status=e),style:{width:"200px"}},{default:t(()=>[(w(),k($,null,B(M,e=>l(v,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}});typeof A=="function"&&A(J);const ve=ie(J,[["__scopeId","data-v-6f1a0c19"]]);export{ve as default};
