
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as G,r as i,A as L,c as N,e as U,J as W,f as l,Q as X,w as a,O as Y,I as z,i as u,o as g,h as d,t as k,H as D,E as p,U as Z,v as ee,x as O}from"./index-CdiJTMf6.js";import{O as w}from"./orders-BJRiLtUw.js";const le={class:"orders-page"},te={class:"toolbar"},ae={style:{"margin-top":"12px","text-align":"right"}},oe={key:0},ne={style:{"margin-bottom":"8px"}},F=G({__name:"admin-orders",setup(ie){const b=i(!1),B=i([]),c=i(1),V=i(20),S=i(0),x=i(""),C=i(""),_=i(!1),K=i(),s=i({tracking_no:"",logistics_provider:""}),y=i(!1),m=i(null);async function v(){var o;b.value=!0;try{const{data:e}=await w.list({page:c.value,limit:V.value,status:x.value||void 0,q:C.value||void 0});B.value=(e==null?void 0:e.items)||[],S.value=((o=e==null?void 0:e.pagination)==null?void 0:o.total)||0}finally{b.value=!1}}function M(o){if(o.status!=="paid")return p.warning("仅已支付订单可发货");s.value={id:o.id,tracking_no:"",logistics_provider:""},_.value=!0}async function A(){if(s.value.id){if(!s.value.tracking_no)return p.warning("请填写物流单号");try{await w.ship(s.value.id,{tracking_no:s.value.tracking_no,logistics_provider:s.value.logistics_provider}),p.success("已发货"),_.value=!1,v()}catch(o){p.error((o==null?void 0:o.message)||"发货失败")}}}async function P(o){if(o.status!=="shipped")return p.warning("仅已发货订单可完成");await Z.confirm("确认标记为已签收完成？","完成签收",{type:"warning"}),await w.complete(o.id),p.success("已完成"),v()}async function R(o){try{const{data:e}=await w.detail(o.id);m.value=e,y.value=!0}catch(e){p.error((e==null?void 0:e.message)||"获取详情失败")}}return L(v),(o,e)=>{const h=u("el-input"),f=u("el-option"),j=u("el-select"),r=u("el-button"),n=u("el-table-column"),H=u("el-tag"),$=u("el-table"),J=u("el-pagination"),q=u("el-form-item"),Q=u("el-form"),E=u("el-dialog"),T=Y("loading");return g(),N("div",le,[U("div",te,[l(h,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=t=>C.value=t),placeholder:"搜索订单号",clearable:"",style:{width:"220px"},onKeyup:e[1]||(e[1]=X(()=>{c.value=1,v()},["enter"]))},null,8,["modelValue"]),l(j,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=t=>x.value=t),placeholder:"状态",clearable:"",style:{width:"140px","margin-left":"8px"}},{default:a(()=>[l(f,{label:"全部",value:""}),l(f,{label:"待支付",value:"pending"}),l(f,{label:"已支付",value:"paid"}),l(f,{label:"已发货",value:"shipped"}),l(f,{label:"已完成",value:"completed"}),l(f,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"]),l(r,{type:"primary",style:{"margin-left":"8px"},loading:b.value,onClick:e[3]||(e[3]=()=>{c.value=1,v()})},{default:a(()=>[...e[12]||(e[12]=[d("查询",-1)])]),_:1},8,["loading"])]),W((g(),z($,{data:B.value,border:""},{default:a(()=>[l(n,{prop:"id",label:"#",width:"70"}),l(n,{prop:"order_no",label:"订单号",width:"180"}),l(n,{prop:"status",label:"状态",width:"100"},{default:a(({row:t})=>[l(H,{type:t.status==="paid"?"success":t.status==="shipped"?"warning":t.status==="completed"?"info":t.status==="cancelled"?"danger":"default"},{default:a(()=>[d(k(t.status),1)]),_:2},1032,["type"])]),_:1}),l(n,{prop:"pay_amount",label:"应付(元)",width:"110"}),l(n,{prop:"tracking_no",label:"物流单号",width:"180"}),l(n,{prop:"logistics_provider",label:"承运商",width:"120"}),l(n,{label:"操作",width:"260"},{default:a(({row:t})=>[t.status==="paid"?(g(),z(r,{key:0,size:"small",type:"primary",onClick:I=>M(t)},{default:a(()=>[...e[13]||(e[13]=[d("发货",-1)])]),_:1},8,["onClick"])):D("",!0),t.status==="shipped"?(g(),z(r,{key:1,size:"small",type:"success",onClick:I=>P(t)},{default:a(()=>[...e[14]||(e[14]=[d("完成",-1)])]),_:1},8,["onClick"])):D("",!0),l(r,{size:"small",onClick:I=>R(t)},{default:a(()=>[...e[15]||(e[15]=[d("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[T,b.value]]),U("div",ae,[l(J,{"current-page":c.value,"onUpdate:currentPage":e[4]||(e[4]=t=>c.value=t),"page-size":V.value,"onUpdate:pageSize":e[5]||(e[5]=t=>V.value=t),total:S.value,layout:"prev, pager, next, sizes, jumper",onChange:v},null,8,["current-page","page-size","total"])]),l(E,{modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=t=>_.value=t),title:"订单发货",width:"460px"},{footer:a(()=>[l(r,{onClick:e[8]||(e[8]=t=>_.value=!1)},{default:a(()=>[...e[16]||(e[16]=[d("取消",-1)])]),_:1}),l(r,{type:"primary",onClick:A},{default:a(()=>[...e[17]||(e[17]=[d("确定发货",-1)])]),_:1})]),default:a(()=>[l(Q,{model:s.value,ref_key:"shipFormRef",ref:K,"label-width":"100px"},{default:a(()=>[l(q,{label:"物流单号",required:""},{default:a(()=>[l(h,{modelValue:s.value.tracking_no,"onUpdate:modelValue":e[6]||(e[6]=t=>s.value.tracking_no=t),placeholder:"填写物流单号"},null,8,["modelValue"])]),_:1}),l(q,{label:"承运商"},{default:a(()=>[l(h,{modelValue:s.value.logistics_provider,"onUpdate:modelValue":e[7]||(e[7]=t=>s.value.logistics_provider=t),placeholder:"如：顺丰/中通/圆通"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(E,{modelValue:y.value,"onUpdate:modelValue":e[11]||(e[11]=t=>y.value=t),title:"订单详情",width:"720px"},{footer:a(()=>[l(r,{onClick:e[10]||(e[10]=t=>y.value=!1)},{default:a(()=>[...e[18]||(e[18]=[d("关闭",-1)])]),_:1})]),default:a(()=>[m.value?(g(),N("div",oe,[U("div",ne,"订单号："+k(m.value.order_no)+" | 状态："+k(m.value.status)+" | 应付：￥"+k(m.value.pay_amount),1),l($,{data:m.value.items||[],size:"small",border:""},{default:a(()=>[l(n,{prop:"product_id",label:"商品ID",width:"90"}),l(n,{prop:"sku_id",label:"SKU",width:"90"}),l(n,{prop:"name",label:"名称"}),l(n,{prop:"size",label:"尺码",width:"80"}),l(n,{prop:"color",label:"颜色",width:"80"}),l(n,{prop:"quantity",label:"数量",width:"80"}),l(n,{prop:"price",label:"单价",width:"90"}),l(n,{prop:"amount",label:"金额",width:"100"})]),_:1},8,["data"])])):D("",!0)]),_:1},8,["modelValue"])])}}});typeof O=="function"&&O(F);const de=ee(F,[["__scopeId","data-v-770a523f"]]);export{de as default};
