import{d as E,r as h,o as V,p as M,q as D,a as p,c as O,b as j,e as o,w as c,f as y,h as i,j as b,n as v,k as m,i as q,v as w,E as d,_ as I}from"./index-DaL8kBdz.js";const R={class:"orders"},T=E({__name:"Orders",setup(z){const C=q(),_=h(!1),g=h([]);async function r(){_.value=!0;try{const{data:e}=await i.get("/api/orders");e?.success&&(g.value=e.data||[])}finally{_.value=!1}}function x(e){C.push(`/orders/${e.id}`)}async function $(e){await w.confirm("确定取消该订单？","提示");const{data:t}=await i.post(`/api/orders/${e.id}/cancel`);t?.success&&(d.success("已取消"),r())}async function N(e){try{const t=await i.get("/api/wallet/me").then(f=>f.data?.data),s=Number(t?.balance||0),n=Number(e.pay_amount||e.total_amount||0),u=(await i.get("/api/auth/me").then(f=>f.data?.data))?.id,a=u&&s>=n?{customer_id:u}:void 0,{data:l}=await i.post(`/api/orders/${e.id}/pay`,a);l?.success&&(d.success("支付成功"),r())}catch(t){d.error(t?.message||"支付失败")}}async function B(e){try{await w.confirm("确认已收到货物？","确认收货",{type:"warning"});const{data:t}=await i.post(`/api/orders/${e.id}/confirm`);t?.success&&(d.success("已确认收货"),r())}catch(t){t?.message&&t?.message!=="cancel"&&d.error(t?.message)}}return V(r),(e,t)=>{const s=y("el-table-column"),n=y("el-button"),k=y("el-table"),u=D("loading");return M((p(),O("div",R,[t[4]||(t[4]=j("h2",null,"我的订单",-1)),o(k,{data:g.value,border:""},{default:c(()=>[o(s,{prop:"order_no",label:"订单号",width:"180"}),o(s,{prop:"status",label:"状态",width:"120"}),o(s,{prop:"pay_status",label:"支付",width:"120"}),o(s,{prop:"total_amount",label:"金额",width:"120"}),o(s,{prop:"logistics_provider",label:"承运商",width:"120"}),o(s,{prop:"tracking_no",label:"物流单号",width:"180"}),o(s,{label:"操作",width:"280"},{default:c(({row:a})=>[o(n,{type:"text",onClick:l=>x(a)},{default:c(()=>[...t[0]||(t[0]=[m("详情",-1)])]),_:1},8,["onClick"]),a.status==="pending"?(p(),b(n,{key:0,type:"text",onClick:l=>N(a)},{default:c(()=>[...t[1]||(t[1]=[m("去支付",-1)])]),_:1},8,["onClick"])):v("",!0),a.status==="shipped"?(p(),b(n,{key:1,type:"text",onClick:l=>B(a)},{default:c(()=>[...t[2]||(t[2]=[m("确认收货",-1)])]),_:1},8,["onClick"])):v("",!0),a.status!=="shipped"&&a.status!=="completed"&&a.status!=="cancelled"?(p(),b(n,{key:2,type:"text",onClick:l=>$(a)},{default:c(()=>[...t[3]||(t[3]=[m("取消",-1)])]),_:1},8,["onClick"])):v("",!0)]),_:1})]),_:1},8,["data"])])),[[u,_.value]])}}}),F=I(T,[["__scopeId","data-v-c10aa8a9"]]);export{F as default};
