import{d as M,l as z,r as k,m as D,o as E,p as F,q as U,a as v,c as y,b as l,j as g,n as $,w as u,e as s,t as d,f as r,h as I,k as x,E as j,i as J,_ as K}from"./index-DaL8kBdz.js";const O={class:"cart"},Q={class:"item"},R=["src"],T={class:"name"},A={class:"spec"},G={key:2,class:"footer"},H={class:"total"},L=M({__name:"Cart",setup(P){const C=J(),m=z(),f=k(!1),i=k([]);function q(e){e.quantity>e.available&&(e.quantity=e.available,j.warning("超过可售库存")),e.amount=+(e.quantity*e.price).toFixed(2);const t=m.items.find(n=>n.sku_id===e.sku_id);t&&(t.quantity=e.quantity),localStorage.setItem("cart",JSON.stringify(m.items))}function N(e){m.remove(e.sku_id),i.value=i.value.filter(t=>t.sku_id!==e.sku_id)}const V=D(()=>i.value.reduce((e,t)=>e+t.amount,0).toFixed(2));async function S(){f.value=!0;try{const e=[];for(const t of m.items){const{data:n}=await I.get(`/api/catalog/sku/${t.sku_id}`);if(n?.success){const{sku:o,product:c}=n.data,b=c?.media?.find?.(a=>a.is_main)?.url||c?.image_url||"https://via.placeholder.com/120x120?text=SKU",_=Math.max(0,Number(o.stock)-Number(o.locked_stock||0)),p=Math.min(_||0,t.quantity);e.push({sku_id:o.id,product_id:o.product_id,name:c?.name||"",size:o.size,color:o.color,barcode:o.barcode,image:b,price:Number(o.retail_price||0),quantity:p,available:_,amount:+(Number(o.retail_price||0)*Number(p)).toFixed(2)})}}i.value=e}finally{f.value=!1}}function B(){C.push("/checkout")}return E(S),(e,t)=>{const n=r("el-table-column"),o=r("el-input-number"),c=r("el-button"),b=r("el-table"),_=r("el-empty"),p=U("loading");return F((v(),y("div",O,[t[2]||(t[2]=l("h2",null,"购物车",-1)),i.value.length?(v(),g(b,{key:0,data:i.value,border:""},{default:u(()=>[s(n,{label:"商品","min-width":"260"},{default:u(({row:a})=>[l("div",Q,[l("img",{src:a.image},null,8,R),l("div",null,[l("div",T,d(a.name),1),l("div",A,d(a.size)+" / "+d(a.color)+" （条码："+d(a.barcode)+"）",1)])])]),_:1}),s(n,{prop:"price",label:"单价",width:"120"}),s(n,{label:"数量",width:"160"},{default:u(({row:a})=>[s(o,{modelValue:a.quantity,"onUpdate:modelValue":h=>a.quantity=h,min:1,max:a.available,onChange:h=>q(a)},null,8,["modelValue","onUpdate:modelValue","max","onChange"])]),_:1}),s(n,{prop:"amount",label:"小计",width:"140"}),s(n,{label:"操作",width:"100"},{default:u(({row:a})=>[s(c,{type:"text",onClick:h=>N(a)},{default:u(()=>[...t[0]||(t[0]=[x("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(v(),g(_,{key:1,description:"购物车空空如也"})),i.value.length?(v(),y("div",G,[l("div",H,"合计：¥"+d(V.value),1),s(c,{type:"primary",onClick:B},{default:u(()=>[...t[1]||(t[1]=[x("去结算",-1)])]),_:1})])):$("",!0)])),[[p,f.value]])}}}),X=K(L,[["__scopeId","data-v-c2ce910e"]]);export{X as default};
