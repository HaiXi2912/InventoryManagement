import{d as $,l as G,u as J,r as w,m as _,o as O,c as i,n as v,a,e as d,j as p,w as l,f as o,h as Q,F as B,g as P,b as n,t as k,k as h,E as T,i as W,_ as X}from"./index-DaL8kBdz.js";const Y={key:0,class:"product-detail"},Z=["src"],ee={key:1,class:"detail-image",src:"https://via.placeholder.com/600x360?text=Product"},te={class:"price"},se={key:0,class:"strike"},ae={key:0,class:"specs"},le={class:"spec-row"},oe={class:"stock"},ne={key:0},ue={key:1},ce={key:2},re={class:"actions"},ie=["innerHTML"],de=$({__name:"ProductDetail",setup(_e){const D=J(),E=W(),L=G(),q=Number(D.params.id),s=w(null),y=w(1),f=w(""),u=_(()=>{const t=new Set((s.value?.skus||[]).map(e=>e.size).filter(Boolean));return Array.from(t)}),c=_(()=>u.value.length&&(s.value?.skus||[]).find(t=>t.size===f.value)||null),z=_(()=>{const t=c.value;return t?Math.max(0,Number(t.stock)-Number(t.locked_stock||0)):99}),F=_(()=>c.value?.retail_price??s.value?.retail_price??0),C=_(()=>c.value?.tag_price??s.value?.tag_price??null),H=_(()=>{const t=[];for(const e of s.value?.skus||[]){const g=e.size||"-",b=Math.max(0,Number(e.stock)-Number(e.locked_stock||0)),m=t.findIndex(x=>x.size===g);m===-1?t.push({size:g,stock:b}):t[m].stock=b}return t});function I(t){f.value=t}function N(){if(!(u.value.length&&!c.value)){if(c.value)L.add({sku_id:c.value.id,quantity:y.value});else{T.warning("该商品未配置SKU，请联系管理员完善尺码规格");return}T.success("已加入购物车")}}function R(){N(),E.push("/cart")}async function U(){const{data:t}=await Q.get(`/api/catalog/${q}`);if(!t?.success)return;s.value=t.data;const e=(s.value.skus||[])[0];e&&e.size&&(f.value=e.size)}return O(U),(t,e)=>{const g=o("el-carousel-item"),b=o("el-carousel"),m=o("el-col"),x=o("el-check-tag"),j=o("el-input-number"),S=o("el-button"),A=o("el-row"),V=o("el-table-column"),K=o("el-table"),M=o("el-card");return s.value?(a(),i("div",Y,[d(A,{gutter:20},{default:l(()=>[d(m,{md:10,sm:24},{default:l(()=>[(s.value.media||[]).length?(a(),p(b,{key:0,height:"360px",trigger:"click"},{default:l(()=>[(a(!0),i(B,null,P(s.value.media||[],r=>(a(),p(g,{key:r.id},{default:l(()=>[n("img",{src:r.url,class:"detail-image"},null,8,Z)]),_:2},1024))),128))]),_:1})):(a(),i("img",ee))]),_:1}),d(m,{md:14,sm:24},{default:l(()=>[n("h2",null,k(s.value.name),1),n("div",te,[h(" ¥"+k(F.value)+" ",1),C.value?(a(),i("span",se,"¥"+k(C.value),1)):v("",!0)]),u.value.length?(a(),i("div",ae,[n("div",le,[e[1]||(e[1]=n("span",{class:"label"},"尺码：",-1)),(a(!0),i(B,null,P(u.value,r=>(a(),p(x,{key:r,checked:f.value===r,onChange:()=>I(r),class:"spec-tag"},{default:l(()=>[h(k(r),1)]),_:2},1032,["checked","onChange"]))),128))])])):v("",!0),n("div",oe,[e[2]||(e[2]=h(" 库存： ",-1)),u.value.length&&c.value?(a(),i("span",ne,k(z.value),1)):u.value.length?(a(),i("span",ce,"请选择尺码")):(a(),i("span",ue,"现货"))]),n("div",re,[d(j,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=r=>y.value=r),min:1,max:z.value||99},null,8,["modelValue","max"]),d(S,{type:"primary",onClick:N,disabled:u.value.length&&!c.value},{default:l(()=>[...e[3]||(e[3]=[h("加入购物车",-1)])]),_:1},8,["disabled"]),d(S,{onClick:R,disabled:u.value.length&&!c.value},{default:l(()=>[...e[4]||(e[4]=[h("立即购买",-1)])]),_:1},8,["disabled"])])]),_:1})]),_:1}),u.value.length?(a(),p(M,{key:0,class:"sku-matrix",shadow:"never"},{header:l(()=>[...e[5]||(e[5]=[n("div",{class:"card-header"},"各尺码库存",-1)])]),default:l(()=>[d(K,{data:H.value,border:"",size:"small"},{default:l(()=>[d(V,{prop:"size",label:"尺码",width:"100"}),d(V,{prop:"stock",label:"可用库存",width:"120",align:"right"})]),_:1},8,["data"])]),_:1})):v("",!0),s.value.content?.mobile_html||s.value.content?.rich_html?(a(),p(M,{key:1,class:"content",shadow:"never"},{header:l(()=>[...e[6]||(e[6]=[n("div",{class:"card-header"},"商品详情",-1)])]),default:l(()=>[n("div",{innerHTML:s.value.content?.mobile_html||s.value.content?.rich_html},null,8,ie)]),_:1})):v("",!0)])):v("",!0)}}}),ve=X(de,[["__scopeId","data-v-ae1ed243"]]);export{ve as default};
