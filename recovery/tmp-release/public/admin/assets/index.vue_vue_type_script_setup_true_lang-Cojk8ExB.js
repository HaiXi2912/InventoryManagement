
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{_ as H}from"./index.vue_vue_type_script_setup_true_lang-B3IWB_Sf.js";import{d as v,V as z,U as Q,r as h,F as g,o as f,w as l,X as w,j as e,$ as L,aM as M,D as $,aQ as V,B as W,x as X,R as Y,a1 as J,C as K,G as Z,H as O,n as b,a9 as q,af as ee,ag as ae,Y as S,aR as se,f as t,h as I,t as x,u as N,at as te,c as y,a as p,T as A,y as T,M as j,N as oe,s as le,aS as ne,l as re,_ as ie,ae as ce}from"./index-BOHDOdY5.js";import{e as de}from"./eventBus-CGRXT3Tn.js";import{_ as ue}from"./index-3uvelW7o.js";import{a as pe,t as fe,o as me,s as C,F,_ as P,c as B,d as R}from"./FormMessage.vue_vue_type_script_setup_true_lang-B4pN3y4h.js";const[D,_e]=Q("AvatarRoot");var ve=v({__name:"AvatarRoot",props:{asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(n){return z(),_e({imageLoadingStatus:h("idle")}),(a,s)=>(f(),g(e(L),{"as-child":a.asChild,as:a.as},{default:l(()=>[w(a.$slots,"default")]),_:3},8,["as-child","as"]))}}),he=ve,ge=v({__name:"AvatarFallback",props:{delayMs:{type:Number,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(n){const a=n,s=D();z();const d=h(a.delayMs===void 0);return M(r=>{if(a.delayMs&&V){const c=window.setTimeout(()=>{d.value=!0},a.delayMs);r(()=>{window.clearTimeout(c)})}}),(r,c)=>d.value&&e(s).imageLoadingStatus.value!=="loaded"?(f(),g(e(L),{key:0,"as-child":r.asChild,as:r.as},{default:l(()=>[w(r.$slots,"default")]),_:3},8,["as-child","as"])):$("v-if",!0)}}),ye=ge;function E(n,a){return n?a?(n.src!==a&&(n.src=a),n.complete&&n.naturalWidth>0?"loaded":"loading"):"error":"idle"}function we(n,{referrerPolicy:a,crossOrigin:s}={}){const d=h(!1),r=h(null),c=W(()=>d.value?(!r.value&&V&&(r.value=new window.Image),r.value):null),i=h(E(c.value,n.value)),u=m=>()=>{d.value&&(i.value=m)};return X(()=>{d.value=!0,M(m=>{const o=c.value;if(!o)return;i.value=E(o,n.value);const _=u("loaded"),k=u("error");o.addEventListener("load",_),o.addEventListener("error",k),a!=null&&a.value&&(o.referrerPolicy=a.value),typeof(s==null?void 0:s.value)=="string"&&(o.crossOrigin=s.value),m(()=>{o.removeEventListener("load",_),o.removeEventListener("error",k)})})}),Y(()=>{d.value=!1}),i}var be=v({__name:"AvatarImage",props:{src:{type:String,required:!0},referrerPolicy:{type:null,required:!1},crossOrigin:{type:null,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"img"}},emits:["loadingStatusChange"],setup(n,{emit:a}){const s=n,d=a,{src:r,referrerPolicy:c,crossOrigin:i}=J(s);z();const u=D(),m=we(r,{referrerPolicy:c,crossOrigin:i});return K(m,o=>{d("loadingStatusChange",o),o!=="idle"&&(u.imageLoadingStatus.value=o)},{immediate:!0}),(o,_)=>Z((f(),g(e(L),{role:"img","as-child":o.asChild,as:o.as,src:e(r),"referrer-policy":e(c)},{default:l(()=>[w(o.$slots,"default")]),_:3},8,["as-child","as","src","referrer-policy"])),[[O,e(m)==="loaded"]])}}),xe=be;const ke=v({__name:"Avatar",props:{class:{},size:{default:"sm"},shape:{default:"circle"}},setup(n){const a=n;return(s,d)=>(f(),g(e(he),{class:b(e(q)(e(Ae)({size:s.size,shape:s.shape}),a.class))},{default:l(()=>[w(s.$slots,"default")]),_:3},8,["class"]))}}),Se=v({__name:"AvatarFallback",props:{delayMs:{},asChild:{type:Boolean},as:{}},setup(n){const a=n;return(s,d)=>(f(),g(e(ye),ee(ae(a)),{default:l(()=>[w(s.$slots,"default")]),_:3},16))}}),$e=v({__name:"AvatarImage",props:{src:{},referrerPolicy:{},crossOrigin:{},asChild:{type:Boolean},as:{}},setup(n){const a=n;return(s,d)=>(f(),g(e(xe),S(a,{class:"h-full w-full object-cover"}),{default:l(()=>[w(s.$slots,"default")]),_:3},16))}}),Ae=se("inline-flex items-center justify-center font-normal text-foreground select-none shrink-0 bg-secondary overflow-hidden",{variants:{size:{sm:"h-10 w-10 text-xs",base:"h-16 w-16 text-2xl",lg:"h-32 w-32 text-5xl"},shape:{circle:"rounded-full",square:"rounded-md"}}}),Ce=v({name:"FaAvatar",__name:"index",props:{src:{},fallback:{},shape:{},class:{}},setup(n){const a=n;return(s,d)=>(f(),g(e(ke),{shape:s.shape,class:b(a.class)},{default:l(()=>[t(e($e),{src:s.src},null,8,["src"]),t(e(Se),{class:"inline-flex"},{default:l(()=>[w(s.$slots,"default",{},()=>[I(x(s.fallback),1)])]),_:3})]),_:3},8,["shape","class"]))}}),Fe={class:"w-full flex-col-stretch-center"},Pe=v({name:"EditPasswordForm",__name:"EditPasswordForm",setup(n){const a=N(),s=h(!1),r=pe({validationSchema:fe(me({password:C().min(1,"请输入原密码"),newPassword:C().min(1,"请输入新密码").min(6,"密码长度为6到18位").max(18,"密码长度为6到18位"),checkPassword:C().min(1,"请确认新密码")}).refine(c=>c.newPassword===c.checkPassword,{message:"两次输入的密码不一致",path:["checkPassword"]})),initialValues:{password:"",newPassword:"",checkPassword:""}}).handleSubmit(c=>{s.value=!0,a.editPassword(c).then(async()=>{te.success("模拟修改成功，请重新登录"),a.logout()}).finally(()=>{s.value=!1})});return(c,i)=>{const u=ue,m=T;return f(),y("div",Fe,[i[2]||(i[2]=p("div",{class:"mb-6 space-y-2"},[p("h3",{class:"text-4xl color-[var(--el-text-color-primary)] font-bold"}," 修改密码 "),p("p",{class:"text-sm text-muted-foreground lg:text-base"}," 请输入原密码、新密码和确认密码 ")],-1)),p("form",{onSubmit:i[0]||(i[0]=(...o)=>e(r)&&e(r)(...o))},[t(e(F),{name:"password"},{default:l(({componentField:o,errors:_})=>[t(e(P),{class:"relative pb-6 space-y-0"},{default:l(()=>[t(e(B),null,{default:l(()=>[t(u,S({type:"password",placeholder:"请输入原密码",class:["w-full",_.length&&"border-destructive"]},o),null,16,["class"])]),_:2},1024),t(A,{"enter-active-class":"transition-opacity","enter-from-class":"opacity-0","leave-active-class":"transition-opacity","leave-to-class":"opacity-0"},{default:l(()=>[t(e(R),{class:"absolute bottom-1 text-xs"})]),_:1})]),_:2},1024)]),_:1}),t(e(F),{name:"newPassword"},{default:l(({componentField:o,errors:_})=>[t(e(P),{class:"relative pb-6 space-y-0"},{default:l(()=>[t(e(B),null,{default:l(()=>[t(u,S({type:"password",placeholder:"请输入新密码",class:["w-full",_.length&&"border-destructive"]},o),null,16,["class"])]),_:2},1024),t(A,{"enter-active-class":"transition-opacity","enter-from-class":"opacity-0","leave-active-class":"transition-opacity","leave-to-class":"opacity-0"},{default:l(()=>[t(e(R),{class:"absolute bottom-1 text-xs"})]),_:1})]),_:2},1024)]),_:1}),t(e(F),{name:"checkPassword"},{default:l(({componentField:o,errors:_})=>[t(e(P),{class:"relative pb-6 space-y-0"},{default:l(()=>[t(e(B),null,{default:l(()=>[t(u,S({type:"password",placeholder:"请确认新密码",class:["w-full",_.length&&"border-destructive"]},o),null,16,["class"])]),_:2},1024),t(A,{"enter-active-class":"transition-opacity","enter-from-class":"opacity-0","leave-active-class":"transition-opacity","leave-to-class":"opacity-0"},{default:l(()=>[t(e(R),{class:"absolute bottom-1 text-xs"})]),_:1})]),_:2},1024)]),_:1}),t(m,{loading:e(s),size:"lg",class:"mt-8 w-full",type:"submit"},{default:l(()=>[...i[1]||(i[1]=[I(" 保存 ",-1)])]),_:1},8,["loading"])],32)])}}}),Be={class:"min-h-full w-full"},Re={class:"fixed right-0 top-0 z-1 flex flex-row overflow-auto border-b border-e bg-background md:inset-s-0 md:bottom-0 md:h-full md:w-40 md:flex-col"},qe=["onClick"],ze={class:"text-base text-accent-foreground leading-tight"},Le={class:"text-xs text-accent-foreground/50"},Ee={class:"min-h-full flex-col-center p-10 pt-20 md:ms-40 md:pt-10"},Me={key:0},Ve=v({__name:"profile",setup(n){const a=h(0),s=h([{title:"基本设置",description:"账号的基本信息，头像、昵称等"},{title:"安全设置",description:"定期修改密码可以提高帐号安全性"}]);return(d,r)=>(f(),y("div",Be,[p("div",Re,[(f(!0),y(j,null,oe(e(s),(c,i)=>(f(),y("div",{key:i,class:b(["flex-shrink-0 cursor-pointer px-4 py-3 transition-background-color space-y-2 hover-bg-accent/50",{"bg-accent hover-bg-accent!":e(a)===i}]),onClick:u=>a.value=i},[p("div",ze,x(c.title),1),p("div",Le,x(c.description),1)],10,qe))),128))]),p("div",Ee,[e(a)===0?(f(),y("div",Me," 请开发者自行扩展 ")):$("",!0),e(a)===1?(f(),g(Pe,{key:1})):$("",!0)])]))}}),Ie={class:"space-y-2"},Ne={class:"flex-center-start gap-2"},Te={class:"space-y-1"},je={class:"text-base lh-none"},De={key:0,class:"min-w-0 flex-center-between flex-1 gap-2"},Ue={class:"flex-1 truncate text-start"},Ye=v({__name:"index",props:{onlyAvatar:{type:Boolean},dropdownAlign:{default:"end"},dropdownSide:{default:"right"},buttonVariant:{default:"ghost"},class:{}},setup(n){const a=n,s=re(),d=le(),r=N(),c=h(!1);return(i,u)=>{const m=Ce,o=ie,_=T,k=ne,U=H;return f(),y(j,null,[t(k,{align:i.dropdownAlign,side:i.dropdownSide,items:[[{label:e(d).settings.home.title,icon:"i-mdi:home",handle:()=>e(s).push({path:e(d).settings.home.fullPath}),hide:!e(d).settings.home.enable},{label:"个人设置",icon:"i-mdi:account",handle:()=>c.value=!0}],[{label:"快捷键介绍",icon:"i-mdi:keyboard",handle:()=>e(de).emit("global-hotkeys-intro-toggle"),hide:e(d).mode!=="pc"}],[{label:"退出登录",icon:"i-mdi:logout",handle:()=>e(r).logout(e(d).settings.home.fullPath)}]],class:"flex-center"},{header:l(()=>[p("div",Ie,[u[2]||(u[2]=p("div",{class:"text-xs text-secondary-foreground/50 font-light"}," 当前登录账号 ",-1)),p("div",Ne,[t(m,{src:e(r).avatar,fallback:e(r).account.slice(0,5),shape:"square"},null,8,["src","fallback"]),p("div",Te,[p("div",je,x(e(r).account),1),u[1]||(u[1]=p("div",{class:"text-xs text-secondary-foreground/50 font-normal"}," [ 这里可以显示邮箱 ] ",-1))])])])]),default:l(()=>[t(_,{variant:i.buttonVariant,class:b(e(q)("flex-center gap-1 p-2",{"size-8 p-1":i.onlyAvatar},a.class))},{default:l(()=>[t(m,{src:e(r).avatar,class:b(e(q)("size-6",{"size-full":i.onlyAvatar}))},{default:l(()=>[t(o,{name:"i-carbon:user-avatar-filled",class:"size-6 text-secondary-foreground/50"})]),_:1},8,["src","class"]),i.onlyAvatar?$("",!0):(f(),y("div",De,[p("div",Ue,x(e(r).account),1),t(o,{name:"i-material-symbols:expand-all-rounded"})]))]),_:1},8,["variant","class"])]),_:1},8,["align","side","items"]),t(U,{modelValue:e(c),"onUpdate:modelValue":u[0]||(u[0]=G=>ce(c)?c.value=G:null),"align-center":"",header:!1,footer:!1,"close-on-click-overlay":!1,"close-on-press-escape":!1,class:"h-500px max-w-xl overflow-hidden","content-class":"min-h-full p-0 flex"},{default:l(()=>[t(Ve)]),_:1},8,["modelValue"])],64)}}});export{Ye as _};
