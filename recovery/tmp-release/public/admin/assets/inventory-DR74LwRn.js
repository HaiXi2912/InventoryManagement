
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{Q as z,d as Ie,r as V,B as qe,x as Le,c as U,a as s,f as t,w as o,E as x,i as b,o as _,t as g,M as A,N as H,h as c,G as Fe,O as De,F as C,n as M,g as le,p as $e,q as pe}from"./index-BOHDOdY5.js";import{P as Pe,a as Ae}from"./productExt-DU4KiciP.js";const $={getInventoryList:v=>z.get("/inventory",{params:v}),getInventory:v=>z.get("/inventory/product/".concat(v)),adjustInventory:v=>z.post("/inventory/adjust",v),getInventoryStats:()=>z.get("/inventory/statistics"),getWarehouses:()=>z.get("/inventory/warehouses"),getSkuBatch:v=>{const F=Array.isArray(v)?v.join(","):String(v);return z.get("/stock/batch",{params:{ids:F}})},adjustSkus:v=>z.post("/stock/adjust",v),stocktakeSku:(v,F,d)=>z.post("/stock/stocktake",{sku_id:v,actual_qty:F,remark:d}),stocktakeBatch:v=>z.post("/stock/stocktake/batch",{items:v}),getSkuReservations:v=>z.get("/stock/sku/".concat(v,"/reservations")),exportLogs:v=>z.get("/stock/logs/export.csv",{params:v}),getReasons:()=>z.get("/stock/reasons"),getLowStock:v=>z.get("/stock/low",{params:v}),getSkuMetrics:v=>z.get("/stock/sku/metrics",{params:{ids:v.join(",")}})},Me={class:"inventory-query"},Be={class:"statistics-section"},Ke={class:"stat-content"},Re={class:"stat-value"},Te={class:"stat-content"},Ee={class:"stat-value"},Oe={class:"stat-content"},We={class:"stat-value warning"},Ge={class:"stat-content"},Qe={class:"stat-value danger"},He={class:"search-section"},Je={class:"quick-filters"},Xe={class:"toolbar-section"},Ye={class:"toolbar"},Ze={class:"toolbar-left"},et={class:"toolbar-right"},tt={class:"table-section"},lt={class:"sku-expand"},at={class:"text-ellipsis"},ot={class:"text-ellipsis"},st=["onMouseenter"],nt=["title"],ut={key:2,class:"text-muted"},dt={class:"amount"},it={class:"pagination-section"},rt={class:"size-drawer-body"},ct={class:"text-ellipsis"},pt={class:"text-ellipsis"},me=Ie({__name:"inventory",setup(v){const F=V(!1),d=V({keyword:"",category:"",warehouseId:"",status:"",minStock:"",maxStock:""}),G=V([]),Q=V([]),ae=V(["女装","男装","童装","内衣家居","运动户外","鞋靴","配饰","工装制服","大码/孕产","居家服/睡衣","其他"]),oe=V(0),J=V(20),B=V(1),K=V({totalProducts:0,totalValue:0,lowStockCount:0,outOfStockCount:0}),se={normal:{text:"正常",type:"success"},low:{text:"库存不足",type:"warning"},out:{text:"缺货",type:"danger"},excess:{text:"库存过多",type:"info"}},ke=qe(()=>{var e;let l=G.value;if(d.value.keyword){const n=d.value.keyword.toLowerCase();l=l.filter(p=>(p.productName||"").toLowerCase().includes(n)||(p.sku||"").toLowerCase().includes(n))}if(d.value.category&&(l=l.filter(n=>n.category===d.value.category)),d.value.warehouseId){const n=(e=Q.value.find(p=>p.id===d.value.warehouseId))==null?void 0:e.name;l=l.filter(p=>p.warehouseName===n)}return d.value.status&&(l=l.filter(n=>n.status===d.value.status)),d.value.minStock&&(l=l.filter(n=>n.currentStock>=Number(d.value.minStock))),d.value.maxStock&&(l=l.filter(n=>n.currentStock<=Number(d.value.maxStock))),l}),ve=(l,e,n)=>!l||l===0?"out":typeof e=="number"&&l<=e?"low":typeof n=="number"&&n>0&&l>n?"excess":"normal",j=async()=>{var l,e,n,p,y;F.value=!0;try{const k={page:B.value,limit:J.value};if(d.value.warehouseId){const f=(l=Q.value.find(i=>i.id===d.value.warehouseId))==null?void 0:l.name;f&&(k.warehouse_location=f)}d.value.status==="low"&&(k.low_stock=!0);const m=await $.getInventoryList(k),S=((e=m.data)==null?void 0:e.inventory)||[];G.value=S.map(f=>{var D,W;const i=f.product||{},q=Number(f.current_stock||0),L=Number((D=i.min_stock)!=null?D:0),P=Number((W=i.max_stock)!=null?W:0),r=f.updated_at||f.updatedAt||f.last_update_time||"";return{id:f.id,productId:i.id,productName:i.name||"-",category:i.category||"-",sku:i.code||"-",currentStock:q,minStock:L,maxStock:P,unitPrice:Number(f.average_cost||0),totalValue:Number(f.total_value||q*Number(f.average_cost||0)),warehouseName:f.warehouse_location||"-",location:f.warehouse_location||"-",lastUpdateTime:r?String(r).replace("T"," ").slice(0,19):"-",status:ve(q,L,P)}}),oe.value=Number(((p=(n=m.data)==null?void 0:n.pagination)==null?void 0:p.total_count)||G.value.length),setTimeout(()=>{Ce()},0);try{const i=((y=(await $.getInventoryStats()).data)==null?void 0:y.statistics)||{};K.value={totalProducts:Number(i.total_products||0),totalValue:Number(i.total_value||0),lowStockCount:Number(i.low_stock_products||0),outOfStockCount:Number(i.zero_stock_products||0)}}catch(f){}}catch(k){x.error("加载库存数据失败")}finally{F.value=!1}},fe=async()=>{var l;try{const n=((l=(await $.getWarehouses()).data)==null?void 0:l.warehouses)||[];Q.value=n.map(p=>({id:p,name:p,address:""}))}catch(e){x.error("加载仓库列表失败")}},ge=async()=>{var l;try{const e=await Pe.getCategories();ae.value=((l=e.data)==null?void 0:l.categories)||[]}catch(e){x.error("加载分类列表失败")}},w=V({}),X=V([]),R=async l=>{if(l){w.value[l]||(w.value[l]={loading:!1,list:[]}),w.value[l].loading=!0;try{const p=((await Ae.listSkus(l)).data||[]).map(y=>({id:y.id,size:y.size,color:y.color||"",barcode:y.barcode,sku_code:y.sku_code,stock:Number(y.stock||0),locked_stock:Number(y.locked_stock||0),status:y.status,retail_price:void 0,cost_price:Number(y.cost_price||0)}));if(w.value[l].list=p,p.length){const y=await $.getSkuMetrics(p.map(S=>S.id)),k=(y==null?void 0:y.data)||[],m={};k.forEach(S=>{m[String(S.id)]=S}),w.value[l].list=p.map(S=>{var f,i;return{...S,total_sold:((f=m[String(S.id)])==null?void 0:f.total_sold)||0,sold_30d:((i=m[String(S.id)])==null?void 0:i.sold_30d)||0}})}}catch(e){x.error("加载SKU失败")}finally{w.value[l].loading=!1}}},be=l=>{if(!l)return;const e=w.value[l];(!e||!e.loading&&(!e.list||e.list.length===0))&&R(l)},ye=async l=>{l!=null&&l.productId&&await R(l.productId)},ne=()=>{B.value=1,j()},_e=()=>{d.value={keyword:"",category:"",warehouseId:"",status:"",minStock:"",maxStock:""},B.value=1,j()},we=()=>{window.open("/api/stock/logs/export.csv","_blank")},ue=l=>{const e="/api/stock/logs/export.csv?sku_id=".concat(encodeURIComponent(String(l)));window.open(e,"_blank")},Se=()=>{j()},T=V(!1),Y=V(!1),N=V({sku_id:"",productName:"",size:"",change_qty:1,reason:void 0,remark:""}),de=(l,e)=>{var n;N.value={sku_id:e.id,productName:l.productName,size:e.size,change_qty:1,reason:(n=X.value[0])==null?void 0:n.code,remark:""},T.value=!0},Ve=async()=>{const l=N.value;if(!l.sku_id||!Number.isFinite(Number(l.change_qty))){x.warning("请输入有效的数量");return}try{Y.value=!0,await $.adjustSkus([{sku_id:l.sku_id,change_qty:Number(l.change_qty),reason:l.reason,remark:l.remark}]),x.success("SKU库存已调整"),T.value=!1;const e=Object.keys(w.value).find(n=>w.value[n].list.some(p=>String(p.id)===String(l.sku_id)));e&&await R(e),j()}catch(e){x.error((e==null?void 0:e.message)||"库存调整失败")}finally{Y.value=!1}},E=V(!1),Z=V(!1),I=V({sku_id:"",productName:"",size:"",actual_qty:0,remark:""}),ie=(l,e)=>{I.value={sku_id:e.id,productName:l.productName,size:e.size,actual_qty:e.stock,remark:""},E.value=!0},he=async()=>{const l=I.value;if(!l.sku_id||!Number.isFinite(Number(l.actual_qty))){x.warning("请输入有效的实盘数量");return}try{Z.value=!0,await $.stocktakeSku(l.sku_id,Number(l.actual_qty),l.remark),x.success("盘点完成"),E.value=!1;const e=Object.keys(w.value).find(n=>w.value[n].list.some(p=>String(p.id)===String(l.sku_id)));e&&await R(e),j()}catch(e){x.error((e==null?void 0:e.message)||"盘点失败")}finally{Z.value=!1}},ze=({row:l})=>l?l.status==="low"?"row-warning":l.status==="out"?"row-danger":"":"",O=l=>{d.value.status=l,ne()},Ce=async()=>{const l=(G.value||[]).map(k=>k.productId).filter(Boolean);if(!l.length)return;const e=4;let n=0;const p=async()=>{if(n>=l.length)return;const k=l[n++];try{await R(k)}catch(m){}return p()},y=Array(Math.min(e,l.length)).fill(0).map(()=>p());await Promise.allSettled(y)};return Le(()=>{fe(),ge(),j(),$.getReasons().then(l=>{X.value=(l==null?void 0:l.data)||[]}).catch(()=>{})}),(l,e)=>{const n=b("el-card"),p=b("el-col"),y=b("el-row"),k=b("el-input"),m=b("el-form-item"),S=b("el-option"),f=b("el-select"),i=b("el-button"),q=b("el-form"),L=b("el-check-tag"),P=b("el-skeleton"),r=b("el-table-column"),D=b("el-tooltip"),W=b("el-tag"),ee=b("el-table"),re=b("el-empty"),Ne=b("el-pagination"),ce=b("el-radio-button"),xe=b("el-radio-group"),te=b("el-dialog"),Ue=b("el-drawer"),je=De("loading");return _(),U("div",Me,[s("div",Be,[t(y,{gutter:20},{default:o(()=>[t(p,{span:6},{default:o(()=>[t(n,{class:"stat-card"},{default:o(()=>[s("div",Ke,[s("div",Re,g(K.value.totalProducts),1),e[32]||(e[32]=s("div",{class:"stat-label"},"商品总数",-1))]),e[33]||(e[33]=s("div",{class:"stat-icon total"},[s("i",{class:"ep:goods"})],-1))]),_:1})]),_:1}),t(p,{span:6},{default:o(()=>[t(n,{class:"stat-card"},{default:o(()=>[s("div",Te,[s("div",Ee,"¥"+g(K.value.totalValue.toLocaleString()),1),e[34]||(e[34]=s("div",{class:"stat-label"},"库存总值",-1))]),e[35]||(e[35]=s("div",{class:"stat-icon value"},[s("i",{class:"ep:money"})],-1))]),_:1})]),_:1}),t(p,{span:6},{default:o(()=>[t(n,{class:"stat-card"},{default:o(()=>[s("div",Oe,[s("div",We,g(K.value.lowStockCount),1),e[36]||(e[36]=s("div",{class:"stat-label"},"库存不足",-1))]),e[37]||(e[37]=s("div",{class:"stat-icon warning"},[s("i",{class:"ep:warning"})],-1))]),_:1})]),_:1}),t(p,{span:6},{default:o(()=>[t(n,{class:"stat-card"},{default:o(()=>[s("div",Ge,[s("div",Qe,g(K.value.outOfStockCount),1),e[38]||(e[38]=s("div",{class:"stat-label"},"缺货商品",-1))]),e[39]||(e[39]=s("div",{class:"stat-icon danger"},[s("i",{class:"ep:close"})],-1))]),_:1})]),_:1})]),_:1})]),s("div",He,[t(n,{class:"compact-card",shadow:"never"},{default:o(()=>[t(q,{model:d.value,inline:"",class:"compact-form",size:"small"},{default:o(()=>[t(m,{label:"关键词"},{default:o(()=>[t(k,{modelValue:d.value.keyword,"onUpdate:modelValue":e[0]||(e[0]=a=>d.value.keyword=a),placeholder:"商品名称/SKU",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(m,{label:"分类"},{default:o(()=>[t(f,{modelValue:d.value.category,"onUpdate:modelValue":e[1]||(e[1]=a=>d.value.category=a),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:o(()=>[(_(!0),U(A,null,H(ae.value,a=>(_(),C(S,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"仓库"},{default:o(()=>[t(f,{modelValue:d.value.warehouseId,"onUpdate:modelValue":e[2]||(e[2]=a=>d.value.warehouseId=a),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:o(()=>[(_(!0),U(A,null,H(Q.value,a=>(_(),C(S,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"状态"},{default:o(()=>[t(f,{modelValue:d.value.status,"onUpdate:modelValue":e[3]||(e[3]=a=>d.value.status=a),placeholder:"请选择",clearable:"",style:{width:"120px"}},{default:o(()=>[t(S,{label:"正常",value:"normal"}),t(S,{label:"库存不足",value:"low"}),t(S,{label:"缺货",value:"out"}),t(S,{label:"库存过多",value:"excess"})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"库存范围"},{default:o(()=>[t(k,{modelValue:d.value.minStock,"onUpdate:modelValue":e[4]||(e[4]=a=>d.value.minStock=a),placeholder:"最小库存",type:"number",style:{width:"100px"}},null,8,["modelValue"]),e[40]||(e[40]=s("span",{style:{margin:"0 8px"}},"至",-1)),t(k,{modelValue:d.value.maxStock,"onUpdate:modelValue":e[5]||(e[5]=a=>d.value.maxStock=a),placeholder:"最大库存",type:"number",style:{width:"100px"}},null,8,["modelValue"])]),_:1}),t(m,null,{default:o(()=>[t(i,{type:"primary",size:"small",onClick:ne},{icon:o(()=>[...e[41]||(e[41]=[s("i",{class:"ep:search"},null,-1)])]),default:o(()=>[e[42]||(e[42]=c(" 搜索 ",-1))]),_:1}),t(i,{size:"small",onClick:_e},{default:o(()=>[...e[43]||(e[43]=[c("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),s("div",Je,[e[49]||(e[49]=s("span",{class:"qf-label"},"快速筛选:",-1)),t(L,{checked:!d.value.status,onChange:e[6]||(e[6]=()=>O(""))},{default:o(()=>[...e[44]||(e[44]=[c("全部",-1)])]),_:1},8,["checked"]),t(L,{checked:d.value.status==="normal",onChange:e[7]||(e[7]=()=>O("normal"))},{default:o(()=>[...e[45]||(e[45]=[c("正常",-1)])]),_:1},8,["checked"]),t(L,{type:"warning",checked:d.value.status==="low",onChange:e[8]||(e[8]=()=>O("low"))},{default:o(()=>[...e[46]||(e[46]=[c("低库存",-1)])]),_:1},8,["checked"]),t(L,{type:"danger",checked:d.value.status==="out",onChange:e[9]||(e[9]=()=>O("out"))},{default:o(()=>[...e[47]||(e[47]=[c("缺货",-1)])]),_:1},8,["checked"]),t(L,{type:"info",checked:d.value.status==="excess",onChange:e[10]||(e[10]=()=>O("excess"))},{default:o(()=>[...e[48]||(e[48]=[c("库存过多",-1)])]),_:1},8,["checked"])])]),_:1})]),s("div",Xe,[t(n,{class:"compact-card",shadow:"never"},{default:o(()=>[s("div",Ye,[s("div",Ze,[t(i,{type:"primary",size:"small",onClick:Se},{icon:o(()=>[...e[50]||(e[50]=[s("i",{class:"ep:refresh"},null,-1)])]),default:o(()=>[e[51]||(e[51]=c(" 刷新数据 ",-1))]),_:1})]),s("div",et,[t(i,{type:"success",size:"small",onClick:we},{icon:o(()=>[...e[52]||(e[52]=[s("i",{class:"ep:download"},null,-1)])]),default:o(()=>[e[53]||(e[53]=c(" 导出库存流水CSV ",-1))]),_:1})])])]),_:1})]),s("div",tt,[t(n,{class:"compact-card",shadow:"never"},{default:o(()=>[Fe((_(),C(ee,{data:ke.value,stripe:"",border:"",size:"small",class:"dense-table",style:{width:"100%"},"row-class-name":ze,"default-sort":{prop:"lastUpdateTime",order:"descending"},onExpandChange:ye},{default:o(()=>[t(r,{type:"expand"},{default:o(({row:a})=>[s("div",lt,[!w.value[a.productId]||w.value[a.productId].loading?(_(),C(P,{key:0,rows:3,animated:""})):(_(),U(A,{key:1},[(w.value[a.productId].list||[]).length?(_(),C(ee,{key:0,data:w.value[a.productId].list,size:"small",border:"",class:"dense-table"},{default:o(()=>[t(r,{prop:"size",label:"尺码",width:"90"},{default:o(({row:u})=>[s("span",{class:M(["size-pill",{danger:u.stock===0,warn:u.stock>0&&u.stock<=3}])},g(u.size),3)]),_:1}),t(r,{prop:"barcode",label:"条码","min-width":"140"},{default:o(({row:u})=>[t(D,{content:u.barcode,placement:"top"},{default:o(()=>[s("span",at,g(u.barcode),1)]),_:2},1032,["content"])]),_:1}),t(r,{prop:"sku_code",label:"SKU编码","min-width":"120","class-name":"hide-sm"},{default:o(({row:u})=>[t(D,{content:u.sku_code,placement:"top"},{default:o(()=>[s("span",ot,g(u.sku_code),1)]),_:2},1032,["content"])]),_:1}),t(r,{prop:"stock",label:"库存",width:"90",align:"right"},{default:o(({row:u})=>[s("span",{class:M({"text-danger":u.stock===0,"text-warning":u.stock>0&&u.stock<=3})},g(u.stock),3)]),_:1}),t(r,{prop:"locked_stock",label:"占用",width:"80",align:"right"}),t(r,{label:"销量(总/30天)",width:"140",align:"right"},{default:o(({row:u})=>[c(g(u.total_sold||0)+"/"+g(u.sold_30d||0),1)]),_:1}),t(r,{prop:"status",label:"状态",width:"90",align:"center"},{default:o(({row:u})=>[t(W,{size:"small",type:u.stock===0?"danger":u.stock<=3?"warning":"success"},{default:o(()=>[c(g(u.stock===0?"缺货":u.stock<=3?"低库存":"正常"),1)]),_:2},1032,["type"])]),_:1}),t(r,{label:"操作",width:"220",fixed:"right"},{default:o(({row:u})=>[t(i,{type:"primary",size:"small",onClick:h=>de(a,u)},{default:o(()=>[...e[54]||(e[54]=[c("调整",-1)])]),_:1},8,["onClick"]),t(i,{type:"warning",size:"small",onClick:h=>ie(a,u)},{default:o(()=>[...e[55]||(e[55]=[c("盘点",-1)])]),_:1},8,["onClick"]),t(i,{size:"small",onClick:h=>ue(u.id)},{default:o(()=>[...e[56]||(e[56]=[c("流水",-1)])]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1032,["data"])):(_(),C(re,{key:1,description:"暂无尺码数据"}))],64))])]),_:1}),t(r,{prop:"productName",label:"商品名称",width:"150"}),t(r,{prop:"sku",label:"SKU",width:"120"}),t(r,{prop:"category",label:"分类",width:"100"}),t(r,{label:"尺码库存","min-width":"260"},{default:o(({row:a})=>{var u;return[s("div",{class:"size-inline",onMouseenter:h=>be(a.productId)},[w.value[a.productId]&&(w.value[a.productId].list||[]).length?(_(!0),U(A,{key:0},H(w.value[a.productId].list,h=>(_(),U("span",{key:h.id,class:M(["size-chip",{danger:h.stock===0,warn:h.stock>0&&h.stock<=3}]),title:"".concat(h.size," 库存：").concat(h.stock)},g(h.size)+": "+g(h.stock),11,nt))),128)):(u=w.value[a.productId])!=null&&u.loading?(_(),C(P,{key:1,rows:1,animated:"",style:{width:"160px"}})):(_(),U("span",ut,"—"))],40,st)]}),_:1}),t(r,{prop:"currentStock",label:"当前库存",width:"100",align:"right"},{default:o(({row:a})=>[s("span",{class:M({"text-danger":a.status==="out","text-warning":a.status==="low"})},g(a.currentStock),3)]),_:1}),t(r,{prop:"minStock",label:"最小库存",width:"100",align:"right"}),t(r,{prop:"maxStock",label:"最大库存",width:"100",align:"right"}),t(r,{prop:"unitPrice",label:"单价",width:"100",align:"right"},{default:o(({row:a})=>[c(" ¥"+g(a.unitPrice.toFixed(2)),1)]),_:1}),t(r,{prop:"totalValue",label:"库存价值",width:"120",align:"right"},{default:o(({row:a})=>[s("span",dt,"¥"+g(a.totalValue.toLocaleString()),1)]),_:1}),t(r,{prop:"warehouseName",label:"仓库",width:"100"}),t(r,{prop:"location",label:"库位",width:"100","class-name":"hide-sm"}),t(r,{prop:"status",label:"状态",width:"100",align:"center"},{default:o(({row:a})=>{var u;return[t(W,{type:((u=se[a.status])==null?void 0:u.type)||"info",size:"small"},{default:o(()=>{var h;return[c(g(((h=se[a.status])==null?void 0:h.text)||"未知"),1)]}),_:2},1032,["type"])]}),_:1}),t(r,{prop:"lastUpdateTime",label:"更新时间",width:"150",sortable:""}),t(r,{label:"操作",width:"200",fixed:"right"},{default:o(({row:a})=>[t(i,{size:"small",onClick:u=>l.openSizeDrawer(a)},{default:o(()=>[...e[57]||(e[57]=[c("尺码库存",-1)])]),_:1},8,["onClick"]),t(i,{type:"primary",size:"small",onClick:u=>l.handleStockAdjust(a)},{default:o(()=>[...e[58]||(e[58]=[c(" 库存调整 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[je,F.value]]),s("div",it,[t(Ne,{"current-page":B.value,"onUpdate:currentPage":e[11]||(e[11]=a=>B.value=a),"page-size":J.value,"onUpdate:pageSize":e[12]||(e[12]=a=>J.value=a),total:oe.value,"page-sizes":[20,50,100,200],background:"",small:"",layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:j},null,8,["current-page","page-size","total"])])]),_:1})]),t(te,{modelValue:l.adjustDialogVisible,"onUpdate:modelValue":e[19]||(e[19]=a=>l.adjustDialogVisible=a),title:"库存调整",width:"480px","close-on-click-modal":!1},{footer:o(()=>[t(i,{onClick:e[18]||(e[18]=a=>l.adjustDialogVisible=!1)},{default:o(()=>[...e[61]||(e[61]=[c("取消",-1)])]),_:1}),t(i,{type:"primary",loading:l.adjustLoading,onClick:l.submitAdjust},{default:o(()=>[...e[62]||(e[62]=[c("确定",-1)])]),_:1},8,["loading","onClick"])]),default:o(()=>[t(q,{"label-width":"90px",onSubmit:e[17]||(e[17]=le(()=>{},["prevent"]))},{default:o(()=>[t(m,{label:"商品"},{default:o(()=>[t(k,{"model-value":l.adjustForm.productName,disabled:""},null,8,["model-value"])]),_:1}),t(m,{label:"仓库"},{default:o(()=>[t(k,{modelValue:l.adjustForm.warehouse_location,"onUpdate:modelValue":e[13]||(e[13]=a=>l.adjustForm.warehouse_location=a),placeholder:"仓库"},null,8,["modelValue"])]),_:1}),t(m,{label:"类型"},{default:o(()=>[t(xe,{modelValue:l.adjustForm.adjustment_type,"onUpdate:modelValue":e[14]||(e[14]=a=>l.adjustForm.adjustment_type=a)},{default:o(()=>[t(ce,{label:"in"},{default:o(()=>[...e[59]||(e[59]=[c("入库",-1)])]),_:1}),t(ce,{label:"out"},{default:o(()=>[...e[60]||(e[60]=[c("出库",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"数量"},{default:o(()=>[t(k,{modelValue:l.adjustForm.quantity,"onUpdate:modelValue":e[15]||(e[15]=a=>l.adjustForm.quantity=a),modelModifiers:{number:!0},type:"number",min:"1",placeholder:"数量"},null,8,["modelValue"])]),_:1}),t(m,{label:"原因"},{default:o(()=>[t(k,{modelValue:l.adjustForm.reason,"onUpdate:modelValue":e[16]||(e[16]=a=>l.adjustForm.reason=a),placeholder:"原因（可选）"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(te,{modelValue:T.value,"onUpdate:modelValue":e[25]||(e[25]=a=>T.value=a),title:"SKU 库存调整",width:"520px","close-on-click-modal":!1},{footer:o(()=>[t(i,{onClick:e[24]||(e[24]=a=>T.value=!1)},{default:o(()=>[...e[63]||(e[63]=[c("取消",-1)])]),_:1}),t(i,{type:"primary",loading:Y.value,onClick:Ve},{default:o(()=>[...e[64]||(e[64]=[c("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(q,{"label-width":"90px",onSubmit:e[23]||(e[23]=le(()=>{},["prevent"]))},{default:o(()=>[t(m,{label:"商品"},{default:o(()=>[t(k,{"model-value":N.value.productName,disabled:""},null,8,["model-value"])]),_:1}),t(m,{label:"尺码"},{default:o(()=>[t(k,{"model-value":N.value.size,disabled:""},null,8,["model-value"])]),_:1}),t(m,{label:"数量"},{default:o(()=>[t(k,{modelValue:N.value.change_qty,"onUpdate:modelValue":e[20]||(e[20]=a=>N.value.change_qty=a),modelModifiers:{number:!0},type:"number",placeholder:"正数入库，负数出库"},null,8,["modelValue"])]),_:1}),t(m,{label:"原因"},{default:o(()=>[t(f,{modelValue:N.value.reason,"onUpdate:modelValue":e[21]||(e[21]=a=>N.value.reason=a),placeholder:"选择原因",style:{width:"200px"},clearable:""},{default:o(()=>[(_(!0),U(A,null,H(X.value,a=>(_(),C(S,{key:a.code,label:a.name,value:a.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(m,{label:"备注"},{default:o(()=>[t(k,{modelValue:N.value.remark,"onUpdate:modelValue":e[22]||(e[22]=a=>N.value.remark=a),placeholder:"可选"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(te,{modelValue:E.value,"onUpdate:modelValue":e[30]||(e[30]=a=>E.value=a),title:"SKU 盘点",width:"520px","close-on-click-modal":!1},{footer:o(()=>[t(i,{onClick:e[29]||(e[29]=a=>E.value=!1)},{default:o(()=>[...e[65]||(e[65]=[c("取消",-1)])]),_:1}),t(i,{type:"primary",loading:Z.value,onClick:he},{default:o(()=>[...e[66]||(e[66]=[c("确定",-1)])]),_:1},8,["loading"])]),default:o(()=>[t(q,{"label-width":"90px",onSubmit:e[28]||(e[28]=le(()=>{},["prevent"]))},{default:o(()=>[t(m,{label:"商品"},{default:o(()=>[t(k,{"model-value":I.value.productName,disabled:""},null,8,["model-value"])]),_:1}),t(m,{label:"尺码"},{default:o(()=>[t(k,{"model-value":I.value.size,disabled:""},null,8,["model-value"])]),_:1}),t(m,{label:"实盘数"},{default:o(()=>[t(k,{modelValue:I.value.actual_qty,"onUpdate:modelValue":e[26]||(e[26]=a=>I.value.actual_qty=a),modelModifiers:{number:!0},type:"number",min:"0",placeholder:"请输入实盘数量"},null,8,["modelValue"])]),_:1}),t(m,{label:"备注"},{default:o(()=>[t(k,{modelValue:I.value.remark,"onUpdate:modelValue":e[27]||(e[27]=a=>I.value.remark=a),placeholder:"可选"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Ue,{modelValue:l.sizeDrawerVisible,"onUpdate:modelValue":e[31]||(e[31]=a=>l.sizeDrawerVisible=a),title:l.sizeDrawerTitle,size:"45%","with-header":!0},{default:o(()=>[s("div",rt,[l.sizeDrawerLoading?(_(),C(P,{key:0,rows:4,animated:""})):(_(),U(A,{key:1},[l.sizeList.length?(_(),C(ee,{key:0,data:l.sizeList,size:"small",border:"",class:"dense-table"},{default:o(()=>[t(r,{prop:"size",label:"尺码",width:"90"},{default:o(({row:a})=>[s("span",{class:M(["size-pill",{danger:a.stock===0,warn:a.stock>0&&a.stock<=3}])},g(a.size),3)]),_:1}),t(r,{prop:"barcode",label:"条码","min-width":"140"},{default:o(({row:a})=>[t(D,{content:a.barcode,placement:"top"},{default:o(()=>[s("span",ct,g(a.barcode),1)]),_:2},1032,["content"])]),_:1}),t(r,{prop:"sku_code",label:"SKU编码","min-width":"120","class-name":"hide-sm"},{default:o(({row:a})=>[t(D,{content:a.sku_code,placement:"top"},{default:o(()=>[s("span",pt,g(a.sku_code),1)]),_:2},1032,["content"])]),_:1}),t(r,{prop:"stock",label:"库存",width:"90",align:"right"},{default:o(({row:a})=>[s("span",{class:M({"text-danger":a.stock===0,"text-warning":a.stock>0&&a.stock<=3})},g(a.stock),3)]),_:1}),t(r,{prop:"locked_stock",label:"占用",width:"80",align:"right"}),t(r,{label:"销量(总/30天)",width:"140",align:"right"},{default:o(({row:a})=>[c(g(a.total_sold||0)+"/"+g(a.sold_30d||0),1)]),_:1}),t(r,{label:"操作",width:"220",fixed:"right"},{default:o(({row:a})=>[t(i,{type:"primary",size:"small",onClick:u=>de({productName:l.sizeDrawerProduct.productName},a)},{default:o(()=>[...e[67]||(e[67]=[c("调整",-1)])]),_:1},8,["onClick"]),t(i,{type:"warning",size:"small",onClick:u=>ie({productName:l.sizeDrawerProduct.productName},a)},{default:o(()=>[...e[68]||(e[68]=[c("盘点",-1)])]),_:1},8,["onClick"]),t(i,{size:"small",onClick:u=>ue(a.id)},{default:o(()=>[...e[69]||(e[69]=[c("流水",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])):(_(),C(re,{key:1,description:"暂无尺码数据"}))],64))])]),_:1},8,["modelValue","title"])])}}});typeof pe=="function"&&pe(me);const vt=$e(me,[["__scopeId","data-v-85ba3b32"]]);export{vt as default};
