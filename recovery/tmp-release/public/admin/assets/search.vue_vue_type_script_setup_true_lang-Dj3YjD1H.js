
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{_ as ne}from"./index.vue_vue_type_script_setup_true_lang-B3IWB_Sf.js";import{_ as oe}from"./index.vue_vue_type_script_setup_true_lang-CnA_JhMM.js";import{d as re,ab as ue,s as ie,bp as ce,A as fe,r as L,aC as U,bq as de,B as pe,C as O,x as ve,aA as h,R as me,br as q,F as C,o as d,j as p,w as x,a as o,c as R,M as G,N as J,n as Q,D as I,_ as he,t as W,h as X,f as v,G as xe,ay as _e,L as V,g as B,ae as ye,l as ge}from"./index-BOHDOdY5.js";import ke from"./index-C2o7F7Xj.js";import{_ as be}from"./item.vue_vue_type_script_setup_true_lang-Cz9Ah6qb.js";const Re={class:"h-12 flex flex-shrink-0 items-center"},we={class:"h-full w-14 flex-center"},Se=["onKeydown"],Me={key:0,class:"h-full w-14 flex-center border-s"},Ce={class:"w-full flex justify-between px-4 py-3"},Ie={class:"flex gap-8"},Ve={class:"inline-flex items-center gap-1 text-xs"},Be={class:"inline-flex items-center gap-1 text-xs"},Te={key:0,class:"inline-flex items-center gap-1 text-xs"},ze=["data-index","onClick","onMouseover"],Ne={class:"flex flex-1 flex-col gap-1 truncate border-s px-4 py-3"},$e={class:"truncate text-start text-base font-bold"},De={key:1,class:"h-full flex-col-center py-6 text-secondary-foreground/50"},Ee={key:2,class:"h-full flex-col-center py-6 text-secondary-foreground/50"},Pe=re({name:"NavSearchModal",__name:"search",props:{modelValue:{type:Boolean,default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(Y){const _=ue(Y,"modelValue"),Z=ge(),w=ie(),T=ce(),ee=fe(),i=L(""),K=U("searchInputRef"),{focused:te}=de(K),z=L([]),n=L(-1),N=U("searchResultRef"),M=U("searchResultItemRef"),y=pe(()=>{let a=[];return a=z.value.filter(e=>{let s=!1;return i.value!==""&&(e.title&&(typeof e.title=="function"?e.title().includes(i.value)&&(s=!0):e.title.includes(i.value)&&(s=!0)),e.path.includes(i.value)&&(s=!0),T.getRouteMatchedByPath(e.path).some(l=>{var u,t,r,c;return typeof((u=l.meta)==null?void 0:u.title)=="function"?(t=l.meta)==null?void 0:t.title().includes(i.value):(c=(r=l.meta)==null?void 0:r.title)==null?void 0:c.includes(i.value)})&&(s=!0)),s}),a});O(()=>_.value,a=>{a?(i.value="",n.value=-1,h("up",$),h("down",D),h("enter",E),h("esc",e=>{w.settings.navSearch.enableHotkeys&&(e.preventDefault(),_.value=!1)})):(h.unbind("up",$),h.unbind("down",D),h.unbind("enter",E),h.unbind("esc"))}),O(()=>y.value,()=>{n.value=-1,F()}),ve(()=>{se(),h("command+k, ctrl+k",a=>{w.settings.navSearch.enableHotkeys&&(a.preventDefault(),_.value=!0)})}),me(()=>{h.unbind("command+k, ctrl+k")});function se(){z.value=[],ee.allMenus.forEach(a=>{P(a.children)})}function le(a){var s;let e=!0;return(s=a.children)!=null&&s.every(l=>{var u;return((u=l.meta)==null?void 0:u.menu)===!1})&&(e=!1),e}function P(a,e,s){a.forEach(l=>{var u,t,r,c,f,g,m;((u=l.meta)==null?void 0:u.menu)!==!1&&(l.children&&le(l)?P(l.children,q(e,l.path),(r=(t=l.meta)==null?void 0:t.icon)!=null?r:s):z.value.push({path:q(e,l.path),icon:(f=(c=l.meta)==null?void 0:c.icon)!=null?f:s,title:(g=l.meta)==null?void 0:g.title,link:(m=l.meta)==null?void 0:m.link}))})}function $(){y.value.length&&(n.value-=1,n.value<0&&(n.value=y.value.length-1),F())}function D(){y.value.length&&(n.value+=1,n.value>y.value.length-1&&(n.value=0),F())}function E(){var a,e;n.value!==-1&&((e=(a=M.value)==null?void 0:a.find(s=>Number.parseInt(s.dataset.index)===n.value))==null||e.click())}function F(){var a,e,s,l,u,t,r,c,f,g;if((l=(s=(e=(a=N.value)==null?void 0:a.areaRef)==null?void 0:e.ref)==null?void 0:s.el)!=null&&l.viewportElement){const m=N.value.areaRef.ref.el.viewportElement;let k=0;if(n.value!==-1){k=m.scrollTop;const b=(r=(t=(u=M.value)==null?void 0:u.find(H=>Number.parseInt(H.dataset.index)===n.value))==null?void 0:t.offsetTop)!=null?r:0,S=(g=(f=(c=M.value)==null?void 0:c.find(H=>Number.parseInt(H.dataset.index)===n.value))==null?void 0:f.clientHeight)!=null?g:0,j=m.scrollTop,A=m.clientHeight;b+S>j+A?k=b+S-A:b<=j&&(k=b-16)}m.scrollTo({top:k})}}function ae(a,e){e?window.open(e,"_blank"):Z.push(a),_.value=!1}return(a,e)=>{const s=he,l=oe,u=ne;return d(),C(u,{ref_key:"searchResultRef",ref:N,modelValue:_.value,"onUpdate:modelValue":e[3]||(e[3]=t=>_.value=t),border:"",footer:p(w).mode==="pc",closable:!1,class:"w-full lg-max-w-2xl","content-class":"flex flex-col p-0 min-h-auto","header-class":"p-0","footer-class":"p-0",onOpened:e[4]||(e[4]=t=>te.value=!0)},{header:x(()=>[o("div",Re,[o("div",we,[v(s,{name:"i-ri:search-line",class:"size-4 text-foreground/30"})]),xe(o("input",{ref_key:"searchInputRef",ref:K,"onUpdate:modelValue":e[0]||(e[0]=t=>ye(i)?i.value=t:null),placeholder:"搜索页面，支持标题、URL模糊查询",class:"h-full w-full border-0 rounded-md bg-transparent text-base text-foreground focus-outline-none placeholder-foreground/30",onKeydown:[e[1]||(e[1]=V(B(t=>_.value=!1,["prevent"]),["esc"])),V(B($,["prevent"]),["up"]),V(B(D,["prevent"]),["down"]),V(B(E,["prevent"]),["enter"])]},null,40,Se),[[_e,p(i)]]),p(w).mode==="mobile"?(d(),R("div",Me,[v(s,{name:"i-carbon:close",class:"size-4",onClick:e[2]||(e[2]=t=>_.value=!1)})])):I("",!0)])]),footer:x(()=>[o("div",Ce,[o("div",Ie,[o("div",Ve,[v(l,null,{default:x(()=>[v(s,{name:"i-ion:md-return-left",class:"size-4"})]),_:1}),e[5]||(e[5]=o("span",null,"访问",-1))]),o("div",Be,[v(l,null,{default:x(()=>[v(s,{name:"i-ant-design:caret-up-filled",class:"size-4"})]),_:1}),v(l,null,{default:x(()=>[v(s,{name:"i-ant-design:caret-down-filled",class:"size-4"})]),_:1}),e[6]||(e[6]=o("span",null,"切换",-1))])]),p(w).settings.navSearch.enableHotkeys?(d(),R("div",Te,[v(l,null,{default:x(()=>[...e[7]||(e[7]=[X(" ESC ",-1)])]),_:1}),e[8]||(e[8]=o("span",null,"退出",-1))])):I("",!0)])]),default:x(()=>[o("div",null,[p(y).length>0?(d(!0),R(G,{key:0},J(p(y),(t,r)=>{var c;return d(),R("div",{ref_for:!0,ref_key:"searchResultItemRef",ref:M,key:t.path,class:"p-4","data-index":r,onClick:f=>ae(t.path,t.link),onMouseover:f=>n.value=r},[o("a",{class:Q(["flex cursor-pointer items-center border rounded-lg",{"-mt-4":r!==0,"bg-accent":r===p(n)}])},[t.icon?(d(),C(s,{key:0,name:t.icon,class:Q(["size-5 basis-16 transition",{"scale-120 text-primary":r===p(n)}])},null,8,["name","class"])):I("",!0),o("div",Ne,[o("div",$e,W((c=typeof t.title=="function"?t.title():t.title)!=null?c:"[ 无标题 ]"),1),p(T).getRouteMatchedByPath(t.path).length?(d(),C(ke,{key:0,class:"truncate"},{default:x(()=>[(d(!0),R(G,null,J(p(T).getRouteMatchedByPath(t.path),(f,g)=>(d(),C(be,{key:g,class:"text-xs"},{default:x(()=>{var m,k,b,S;return[X(W((S=typeof((m=f.meta)==null?void 0:m.title)=="function"?(k=f.meta)==null?void 0:k.title():(b=f.meta)==null?void 0:b.title)!=null?S:"[ 无标题 ]"),1)]}),_:2},1024))),128))]),_:2},1024)):I("",!0)])],2)],40,ze)}),128)):p(i)===""?(d(),R("div",De,[v(s,{name:"i-tabler:mood-smile",class:"size-10"}),e[9]||(e[9]=o("p",{class:"m-2 text-base"}," 输入你要搜索的导航 ",-1))])):(d(),R("div",Ee,[v(s,{name:"i-tabler:mood-empty",class:"size-10"}),e[10]||(e[10]=o("p",{class:"m-2 text-base"}," 没有找到你想要的 ",-1))]))])]),_:1},8,["modelValue","footer"])}}});export{Pe as _};
