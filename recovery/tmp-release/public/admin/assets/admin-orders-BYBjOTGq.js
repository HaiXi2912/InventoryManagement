
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{d as A,r as s,x as G,c as L,a as U,G as T,f as l,L as H,w as a,O as J,F as x,i,o as _,h as r,t as Q,D as q,E as v,P as W,p as X,q as B}from"./index-BOHDOdY5.js";import{O as C}from"./orders-LeGzHGUW.js";const Y={class:"orders-page"},Z={class:"toolbar"},ee={style:{"margin-top":"12px","text-align":"right"}},O=A({__name:"admin-orders",setup(le){const g=s(!1),w=s([]),c=s(1),y=s(20),h=s(0),b=s(""),k=s(""),f=s(!1),$=s(),n=s({tracking_no:"",logistics_provider:""});async function d(){var o;g.value=!0;try{const{data:e}=await C.list({page:c.value,limit:y.value,status:b.value||void 0,q:k.value||void 0});w.value=(e==null?void 0:e.items)||[],h.value=((o=e==null?void 0:e.pagination)==null?void 0:o.total)||0}finally{g.value=!1}}function E(o){if(o.status!=="paid")return v.warning("仅已支付订单可发货");n.value={id:o.id,tracking_no:"",logistics_provider:""},f.value=!0}async function F(){if(n.value.id){if(!n.value.tracking_no)return v.warning("请填写物流单号");try{await C.ship(n.value.id,{tracking_no:n.value.tracking_no,logistics_provider:n.value.logistics_provider}),v.success("已发货"),f.value=!1,d()}catch(o){v.error((o==null?void 0:o.message)||"发货失败")}}}async function N(o){if(o.status!=="shipped")return v.warning("仅已发货订单可完成");await W.confirm("确认标记为已签收完成？","完成签收",{type:"warning"}),await C.complete(o.id),v.success("已完成"),d()}return G(d),(o,e)=>{const V=i("el-input"),p=i("el-option"),S=i("el-select"),m=i("el-button"),u=i("el-table-column"),M=i("el-tag"),P=i("el-table"),I=i("el-pagination"),z=i("el-form-item"),K=i("el-form"),R=i("el-dialog"),j=J("loading");return _(),L("div",Y,[U("div",Z,[l(V,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),placeholder:"搜索订单号",clearable:"",style:{width:"220px"},onKeyup:e[1]||(e[1]=H(()=>{c.value=1,d()},["enter"]))},null,8,["modelValue"]),l(S,{modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=t=>b.value=t),placeholder:"状态",clearable:"",style:{width:"140px","margin-left":"8px"}},{default:a(()=>[l(p,{label:"全部",value:""}),l(p,{label:"待支付",value:"pending"}),l(p,{label:"已支付",value:"paid"}),l(p,{label:"已发货",value:"shipped"}),l(p,{label:"已完成",value:"completed"}),l(p,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"]),l(m,{type:"primary",style:{"margin-left":"8px"},loading:g.value,onClick:e[3]||(e[3]=()=>{c.value=1,d()})},{default:a(()=>[...e[10]||(e[10]=[r("查询",-1)])]),_:1},8,["loading"])]),T((_(),x(P,{data:w.value,border:""},{default:a(()=>[l(u,{prop:"id",label:"#",width:"70"}),l(u,{prop:"order_no",label:"订单号",width:"180"}),l(u,{prop:"status",label:"状态",width:"100"},{default:a(({row:t})=>[l(M,{type:t.status==="paid"?"success":t.status==="shipped"?"warning":t.status==="completed"?"info":t.status==="cancelled"?"danger":"default"},{default:a(()=>[r(Q(t.status),1)]),_:2},1032,["type"])]),_:1}),l(u,{prop:"pay_amount",label:"应付(元)",width:"110"}),l(u,{prop:"tracking_no",label:"物流单号",width:"180"}),l(u,{prop:"logistics_provider",label:"承运商",width:"120"}),l(u,{label:"操作",width:"220"},{default:a(({row:t})=>[t.status==="paid"?(_(),x(m,{key:0,size:"small",type:"primary",onClick:D=>E(t)},{default:a(()=>[...e[11]||(e[11]=[r("发货",-1)])]),_:1},8,["onClick"])):q("",!0),t.status==="shipped"?(_(),x(m,{key:1,size:"small",type:"success",onClick:D=>N(t)},{default:a(()=>[...e[12]||(e[12]=[r("完成",-1)])]),_:1},8,["onClick"])):q("",!0),l(m,{size:"small",onClick:D=>o.$router.push({name:"adminOrderDetail",query:{id:t.id}})},{default:a(()=>[...e[13]||(e[13]=[r("详情",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[j,g.value]]),U("div",ee,[l(I,{"current-page":c.value,"onUpdate:currentPage":e[4]||(e[4]=t=>c.value=t),"page-size":y.value,"onUpdate:pageSize":e[5]||(e[5]=t=>y.value=t),total:h.value,layout:"prev, pager, next, sizes, jumper",onChange:d},null,8,["current-page","page-size","total"])]),l(R,{modelValue:f.value,"onUpdate:modelValue":e[9]||(e[9]=t=>f.value=t),title:"订单发货",width:"460px"},{footer:a(()=>[l(m,{onClick:e[8]||(e[8]=t=>f.value=!1)},{default:a(()=>[...e[14]||(e[14]=[r("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:F},{default:a(()=>[...e[15]||(e[15]=[r("确定发货",-1)])]),_:1})]),default:a(()=>[l(K,{model:n.value,ref_key:"shipFormRef",ref:$,"label-width":"100px"},{default:a(()=>[l(z,{label:"物流单号",required:""},{default:a(()=>[l(V,{modelValue:n.value.tracking_no,"onUpdate:modelValue":e[6]||(e[6]=t=>n.value.tracking_no=t),placeholder:"填写物流单号"},null,8,["modelValue"])]),_:1}),l(z,{label:"承运商"},{default:a(()=>[l(V,{modelValue:n.value.logistics_provider,"onUpdate:modelValue":e[7]||(e[7]=t=>n.value.logistics_provider=t),placeholder:"如：顺丰/中通/圆通"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});typeof B=="function"&&B(O);const oe=X(O,[["__scopeId","data-v-f0d2f472"]]);export{oe as default};
