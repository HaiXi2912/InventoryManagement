
/**
 * 由 Fantastic-admin 提供技术支持
 * Powered by Fantastic-admin
 * https://fantastic-admin.hurui.me
 */
    
import{F as V}from"./finance-Bex94iqC.js";import{d as K,r as k,B as n,x as Q,C as W,G as X,O as Z,c as ee,f as a,w as t,E as y,i as f,o as le,a as o,t as s,h as i,p as ae,q as U}from"./index-BOHDOdY5.js";const te={class:"p-4 space-y-4"},oe={class:"flex items-center justify-between flex-wrap gap-2"},se={class:"space-x-2"},de={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4"},ie={class:"kpi-value"},ne={class:"kpi-value"},re={class:"kpi-value"},ue={class:"kpi-value"},ce={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"},ve={class:"kpi-label"},pe={class:"kpi-value"},me={class:"kpi-value"},_e={class:"kpi-value"},fe={class:"kpi-label"},be={class:"kpi-value"},ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},L=K({__name:"settlement",setup(ye){const w=k(new Date().toISOString().split("T")[0]),p=k(new Date().toISOString().slice(0,7)),v=k("completed"),D=k(!1),m=k(null),_=k(null),r=l=>Number(l||0),d=l=>r(l).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),M=n(()=>{var l,e;return r((e=(l=m.value)==null?void 0:l.breakdown)==null?void 0:e.factory_ordered_cost)}),A=n(()=>{var l,e;return r((e=(l=m.value)==null?void 0:l.breakdown)==null?void 0:e.factory_completed_cost)}),O=n(()=>{var l,e;return r((e=(l=m.value)==null?void 0:l.breakdown)==null?void 0:e.ap)}),R=n(()=>{var l,e;return r((e=(l=m.value)==null?void 0:l.breakdown)==null?void 0:e.ar)}),B=n(()=>{var l;return r((l=m.value)==null?void 0:l.total_ordered_view)}),E=n(()=>{var l;return r((l=m.value)==null?void 0:l.total_completed_view)}),T=n(()=>v.value==="completed"?E.value:B.value),Y=n(()=>{var l,e;return r((e=(l=_.value)==null?void 0:l.breakdown)==null?void 0:e.factory_ordered_cost)}),z=n(()=>{var l,e;return r((e=(l=_.value)==null?void 0:l.breakdown)==null?void 0:e.factory_completed_cost)}),F=n(()=>{var l,e;return r((e=(l=_.value)==null?void 0:l.breakdown)==null?void 0:e.ap)}),I=n(()=>{var l,e;return r((e=(l=_.value)==null?void 0:l.breakdown)==null?void 0:e.ar)}),N=n(()=>{var l;return r((l=_.value)==null?void 0:l.total_ordered_view)}),j=n(()=>{var l;return r((l=_.value)==null?void 0:l.total_completed_view)}),P=n(()=>v.value==="completed"?j.value:N.value);async function g(){D.value=!0;try{const[l,e]=await Promise.all([V.getDaily(w.value),V.getMonthly(p.value)]);m.value=(l==null?void 0:l.data)||null,_.value=(e==null?void 0:e.data)||null}catch(l){y.error("加载失败")}finally{D.value=!1}}async function $(){try{await V.closeDaily(w.value),y.success("已关账日清"),await g()}catch(l){y.error("关账失败")}}async function q(){try{await V.closeMonthly(p.value),y.success("已关账月结"),await g()}catch(l){y.error("关账失败")}}async function G(){try{const e=await V.exportMonthly(p.value),h=URL.createObjectURL(e),b=document.createElement("a");b.href=h,b.download="statement-".concat(p.value,".csv"),b.click(),URL.revokeObjectURL(h)}catch(l){y.error("导出失败")}}return Q(g),W([w,p],()=>{g()}),(l,e)=>{const h=f("el-date-picker"),b=f("el-radio-button"),H=f("el-radio-group"),x=f("el-button"),c=f("el-card"),u=f("el-descriptions-item"),S=f("el-descriptions"),J=Z("loading");return X((le(),ee("div",te,[a(c,null,{header:t(()=>[o("div",oe,[e[9]||(e[9]=o("div",{class:"font-600"},"筛选",-1)),o("div",se,[a(h,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=C=>w.value=C),type:"date","value-format":"YYYY-MM-DD",placeholder:"选择日清日期"},null,8,["modelValue"]),a(h,{modelValue:p.value,"onUpdate:modelValue":e[1]||(e[1]=C=>p.value=C),type:"month","value-format":"YYYY-MM",placeholder:"选择月份"},null,8,["modelValue"]),a(H,{modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=C=>v.value=C),size:"small",class:"ml-2"},{default:t(()=>[a(b,{label:"completed"},{default:t(()=>[...e[3]||(e[3]=[i("完成口径",-1)])]),_:1}),a(b,{label:"ordered"},{default:t(()=>[...e[4]||(e[4]=[i("下单口径",-1)])]),_:1})]),_:1},8,["modelValue"]),a(x,{size:"small",onClick:g},{default:t(()=>[...e[5]||(e[5]=[i("刷新",-1)])]),_:1}),a(x,{size:"small",type:"primary",onClick:$},{default:t(()=>[...e[6]||(e[6]=[i("关账日清",-1)])]),_:1}),a(x,{size:"small",type:"primary",onClick:q},{default:t(()=>[...e[7]||(e[7]=[i("关账本月",-1)])]),_:1}),a(x,{size:"small",onClick:G},{default:t(()=>[...e[8]||(e[8]=[i("导出本月CSV",-1)])]),_:1})])])]),default:t(()=>[o("div",de,[a(c,{shadow:"hover",class:"kpi-card"},{default:t(()=>[e[10]||(e[10]=o("div",{class:"kpi-label"},"今日-下单支出",-1)),o("div",ie,"¥"+s(d(M.value)),1)]),_:1}),a(c,{shadow:"hover",class:"kpi-card"},{default:t(()=>[e[11]||(e[11]=o("div",{class:"kpi-label"},"今日-完成成本",-1)),o("div",ne,"¥"+s(d(A.value)),1)]),_:1}),a(c,{shadow:"hover",class:"kpi-card"},{default:t(()=>[e[12]||(e[12]=o("div",{class:"kpi-label"},"今日-AP(应付)",-1)),o("div",re,"¥"+s(d(O.value)),1)]),_:1}),a(c,{shadow:"hover",class:"kpi-card"},{default:t(()=>[e[13]||(e[13]=o("div",{class:"kpi-label"},"今日-AR(应收)",-1)),o("div",ue,"¥"+s(d(R.value)),1)]),_:1})]),o("div",ce,[a(c,{shadow:"hover",class:"kpi-card kpi-accent"},{default:t(()=>[o("div",ve,"今日-口径合计（"+s(v.value==="completed"?"完成":"下单")+"）",1),o("div",pe,"¥"+s(d(T.value)),1)]),_:1}),a(c,{shadow:"hover",class:"kpi-card"},{default:t(()=>[e[14]||(e[14]=o("div",{class:"kpi-label"},"本月-下单支出",-1)),o("div",me,"¥"+s(d(Y.value)),1)]),_:1}),a(c,{shadow:"hover",class:"kpi-card"},{default:t(()=>[e[15]||(e[15]=o("div",{class:"kpi-label"},"本月-完成成本",-1)),o("div",_e,"¥"+s(d(z.value)),1)]),_:1}),a(c,{shadow:"hover",class:"kpi-card"},{default:t(()=>[o("div",fe,"本月-口径合计（"+s(v.value==="completed"?"完成":"下单")+"）",1),o("div",be,"¥"+s(d(P.value)),1)]),_:1})]),o("div",ke,[a(S,{column:1,title:"今日（日清）",size:"small",border:""},{default:t(()=>[a(u,{label:"下单支出(¥)"},{default:t(()=>[i(s(d(M.value)),1)]),_:1}),a(u,{label:"完成成本(¥)"},{default:t(()=>[i(s(d(A.value)),1)]),_:1}),a(u,{label:"应付AP(¥)"},{default:t(()=>[i(s(d(O.value)),1)]),_:1}),a(u,{label:"应收AR(¥)"},{default:t(()=>[i(s(d(R.value)),1)]),_:1}),a(u,{label:"口径合计(".concat(v.value==="completed"?"完成":"下单",")")},{default:t(()=>[i(s(d(T.value)),1)]),_:1},8,["label"])]),_:1}),a(S,{column:1,title:"本月（月结)",size:"small",border:""},{default:t(()=>[a(u,{label:"下单支出(¥)"},{default:t(()=>[i(s(d(Y.value)),1)]),_:1}),a(u,{label:"完成成本(¥)"},{default:t(()=>[i(s(d(z.value)),1)]),_:1}),a(u,{label:"应付AP(¥)"},{default:t(()=>[i(s(d(F.value)),1)]),_:1}),a(u,{label:"应收AR(¥)"},{default:t(()=>[i(s(d(I.value)),1)]),_:1}),a(u,{label:"口径合计(".concat(v.value==="completed"?"完成":"下单",")")},{default:t(()=>[i(s(d(P.value)),1)]),_:1},8,["label"])]),_:1})]),e[16]||(e[16]=o("div",{class:"hint"},"注：完成成本用于正式记账；下单支出为预算口径。",-1))]),_:1})])),[[J,D.value]])}}});typeof U=="function"&&U(L);const he=ae(L,[["__scopeId","data-v-ddc4b73d"]]);export{he as default};
