<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIè¿æ¥æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-button { background: #007bff; color: white; border: none; padding: 10px 20px; margin: 10px; border-radius: 4px; cursor: pointer; }
        .test-button:hover { background: #0056b3; }
        .result { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 4px; white-space: pre-wrap; font-family: monospace; }
        .success { border-color: #28a745; background: #d4edda; }
        .error { border-color: #dc3545; background: #f8d7da; }
        h1 { color: #333; text-align: center; }
        h2 { color: #666; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ APIè¿æ¥æµ‹è¯•å·¥å…·</h1>
        
        <h2>æœåŠ¡å™¨çŠ¶æ€æµ‹è¯•</h2>
        <button class="test-button" onclick="testServerHealth()">æµ‹è¯•æœåŠ¡å™¨å¥åº·çŠ¶æ€</button>
        <button class="test-button" onclick="testApiDocs()">è®¿é—®APIæ–‡æ¡£</button>
        
        <h2>è®¤è¯æµ‹è¯•</h2>
        <button class="test-button" onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
        <button class="test-button" onclick="testUserInfo()">æµ‹è¯•è·å–ç”¨æˆ·ä¿¡æ¯</button>
        
        <h2>å•†å“ç®¡ç†æµ‹è¯•</h2>
        <button class="test-button" onclick="testProducts()">æµ‹è¯•å•†å“åˆ—è¡¨</button>
        <button class="test-button" onclick="testCreateProduct()">æµ‹è¯•åˆ›å»ºå•†å“</button>
        
        <h2>åº“å­˜ç®¡ç†æµ‹è¯•</h2>
        <button class="test-button" onclick="testInventory()">æµ‹è¯•åº“å­˜åˆ—è¡¨</button>
        <button class="test-button" onclick="testInventoryStats()">æµ‹è¯•åº“å­˜ç»Ÿè®¡</button>
        
        <div id="result" class="result" style="display: none;"></div>
        
        <h2>å½“å‰çŠ¶æ€</h2>
        <div id="status" class="result">
            å‰ç«¯åœ°å€: http://localhost:5173<br>
            åç«¯åœ°å€: http://localhost:3000<br>
            APIä»£ç†: /api -> http://localhost:3000<br>
            çŠ¶æ€: å‡†å¤‡æµ‹è¯•...
        </div>
    </div>

    <script>
        let currentToken = '';
        
        function showResult(message, isError = false) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = message;
            resultDiv.style.display = 'block';
            resultDiv.className = 'result ' + (isError ? 'error' : 'success');
        }
        
        async function testServerHealth() {
            try {
                showResult('æ­£åœ¨æµ‹è¯•æœåŠ¡å™¨å¥åº·çŠ¶æ€...');
                const response = await fetch('http://localhost:3000/health');
                const data = await response.json();
                showResult('æœåŠ¡å™¨å¥åº·çŠ¶æ€æµ‹è¯•æˆåŠŸï¼\n' + JSON.stringify(data, null, 2));
            } catch (error) {
                showResult('æœåŠ¡å™¨å¥åº·çŠ¶æ€æµ‹è¯•å¤±è´¥ï¼š' + error.message, true);
            }
        }
        
        async function testApiDocs() {
            window.open('http://localhost:3000/api', '_blank');
        }
        
        async function testLogin() {
            try {
                showResult('æ­£åœ¨æµ‹è¯•ç™»å½•...');
                const response = await fetch('http://localhost:3000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'admin',
                        password: 'admin123'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    currentToken = data.data.token;
                    showResult('ç™»å½•æµ‹è¯•æˆåŠŸï¼\n' + JSON.stringify(data, null, 2));
                } else {
                    showResult('ç™»å½•æµ‹è¯•å¤±è´¥ï¼š' + data.message, true);
                }
            } catch (error) {
                showResult('ç™»å½•æµ‹è¯•å¤±è´¥ï¼š' + error.message, true);
            }
        }
        
        async function testUserInfo() {
            if (!currentToken) {
                showResult('è¯·å…ˆæµ‹è¯•ç™»å½•è·å–token', true);
                return;
            }
            
            try {
                showResult('æ­£åœ¨æµ‹è¯•è·å–ç”¨æˆ·ä¿¡æ¯...');
                const response = await fetch('http://localhost:3000/api/auth/me', {
                    headers: {
                        'Authorization': 'Bearer ' + currentToken
                    }
                });
                
                const data = await response.json();
                showResult('è·å–ç”¨æˆ·ä¿¡æ¯æµ‹è¯•æˆåŠŸï¼\n' + JSON.stringify(data, null, 2));
            } catch (error) {
                showResult('è·å–ç”¨æˆ·ä¿¡æ¯æµ‹è¯•å¤±è´¥ï¼š' + error.message, true);
            }
        }
        
        async function testProducts() {
            if (!currentToken) {
                showResult('è¯·å…ˆæµ‹è¯•ç™»å½•è·å–token', true);
                return;
            }
            
            try {
                showResult('æ­£åœ¨æµ‹è¯•å•†å“åˆ—è¡¨...');
                const response = await fetch('http://localhost:3000/api/products?limit=5', {
                    headers: {
                        'Authorization': 'Bearer ' + currentToken
                    }
                });
                
                const data = await response.json();
                showResult('å•†å“åˆ—è¡¨æµ‹è¯•æˆåŠŸï¼\n' + JSON.stringify(data, null, 2));
            } catch (error) {
                showResult('å•†å“åˆ—è¡¨æµ‹è¯•å¤±è´¥ï¼š' + error.message, true);
            }
        }
        
        async function testCreateProduct() {
            if (!currentToken) {
                showResult('è¯·å…ˆæµ‹è¯•ç™»å½•è·å–token', true);
                return;
            }
            
            try {
                showResult('æ­£åœ¨æµ‹è¯•åˆ›å»ºå•†å“...');
                const response = await fetch('http://localhost:3000/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + currentToken
                    },
                    body: JSON.stringify({
                        name: 'æµ‹è¯•å•†å“',
                        code: 'TEST-' + Date.now(),
                        category: 'æµ‹è¯•åˆ†ç±»',
                        purchase_price: 100,
                        retail_price: 150,
                        description: 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å•†å“'
                    })
                });
                
                const data = await response.json();
                showResult('åˆ›å»ºå•†å“æµ‹è¯•æˆåŠŸï¼\n' + JSON.stringify(data, null, 2));
            } catch (error) {
                showResult('åˆ›å»ºå•†å“æµ‹è¯•å¤±è´¥ï¼š' + error.message, true);
            }
        }
        
        async function testInventory() {
            if (!currentToken) {
                showResult('è¯·å…ˆæµ‹è¯•ç™»å½•è·å–token', true);
                return;
            }
            
            try {
                showResult('æ­£åœ¨æµ‹è¯•åº“å­˜åˆ—è¡¨...');
                const response = await fetch('http://localhost:3000/api/inventory?limit=5', {
                    headers: {
                        'Authorization': 'Bearer ' + currentToken
                    }
                });
                
                const data = await response.json();
                showResult('åº“å­˜åˆ—è¡¨æµ‹è¯•æˆåŠŸï¼\n' + JSON.stringify(data, null, 2));
            } catch (error) {
                showResult('åº“å­˜åˆ—è¡¨æµ‹è¯•å¤±è´¥ï¼š' + error.message, true);
            }
        }
        
        async function testInventoryStats() {
            if (!currentToken) {
                showResult('è¯·å…ˆæµ‹è¯•ç™»å½•è·å–token', true);
                return;
            }
            
            try {
                showResult('æ­£åœ¨æµ‹è¯•åº“å­˜ç»Ÿè®¡...');
                const response = await fetch('http://localhost:3000/api/statistics/inventory', {
                    headers: {
                        'Authorization': 'Bearer ' + currentToken
                    }
                });
                
                const data = await response.json();
                showResult('åº“å­˜ç»Ÿè®¡æµ‹è¯•æˆåŠŸï¼\n' + JSON.stringify(data, null, 2));
            } catch (error) {
                showResult('åº“å­˜ç»Ÿè®¡æµ‹è¯•å¤±è´¥ï¼š' + error.message, true);
            }
        }
    </script>
</body>
</html>
